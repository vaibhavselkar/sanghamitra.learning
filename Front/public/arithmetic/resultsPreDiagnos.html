<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Test Results - Sanghamitra Learning</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="../assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Mentor
  * Template URL: https://bootstrapmade.com/mentor-free-education-bootstrap-theme/
  * Updated: Mar 19 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<style>
    .results-section {
  padding: 40px 0;
}

.stat-item {
  text-align: center;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
}

.stat-value {
  font-size: 2.2rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.stat-label {
  color: #6c757d;
  margin-bottom: 0;
}

.question-card {
  transition: transform 0.2s;
}

.question-card:hover {
  transform: translateY(-3px);
}

.explanation {
  border-left: 3px solid #0d6efd;
}

.badge {
  font-size: 0.9rem;
  padding: 0.5em 0.75em;
}
.concept-pill {
  padding: 0.5em 1em;
  background: #ffeeba;
  border-radius: 20px;
  font-size: 0.9rem;
  margin: 0.25rem;
}

.concept-link {
  text-decoration: none;
  color: #856404;
  transition: all 0.2s;
}

.concept-link:hover {
  background: #ffda6a;
  color: #523e02;
}
.tested-concept-badge {
  background-color: #ffeeba !important;
  color: #856404 !important;
  border: 1px solid #ffda6a;
}

.tested-concept-badge:hover {
  background-color: #ffda6a !important;
  color: #523e02 !important;
}
</style>


<body>

    <header id="header" class="header d-flex align-items-center sticky-top">
      <div class="container-fluid container-xl position-relative d-flex align-items-center">
  
        <a href="index.html" class="logo d-flex align-items-center me-auto">
          <img src="../img/sbi.logo.png" alt="Logo" width="80" height="80"> 
          <h1 class="">Sanghamitra Learning</h1>
        </a>
  
        <nav id="navmenu" class="navmenu">
          <div id="navbar-placeholder"></div>
          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>
  
      </div>
    </header>
  
    <main class="main">
  
      <!-- Page Title -->
      <div class="page-title" data-aos="fade" style="margin-bottom: 2rem;">
        <div class="heading">
          <div class="container">
            <div class="row d-flex justify-content-center text-center">
              <div class="col-lg-8">
                <h1>Your Test Results</h1>
                <p class="mb-0">Detailed analysis of your diagnostic test performance</p>
              </div>
            </div>
          </div>
        </div>
        <nav class="breadcrumbs">
          <div class="container">
            <ol>
              <li><a href="../index.html">Home</a></li>
              <li><a href="../math.html">Math</a></li>
              <li><a href="arithmetic.html">Arithmetic</a></li>
              <li class="../current">Pre-Diagnostic-Test</li>
            </ol>
          </div>
        </nav>
      </div><!-- End Page Title -->

      <section class="results-section">
        <div class="container" data-aos="fade-up">
          <!-- Summary Card -->
          <div class="summary-card card shadow-sm mb-4">
            <div class="card-body">
              <h3 class="card-title mb-4">Test Summary</h3>
              <div class="row">
                <div class="col-md-4">
                  <div class="stat-item">
                    <h4 class="stat-value" id="total-questions">0</h4>
                    <p class="stat-label">Total Questions</p>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="stat-item">
                    <h4 class="stat-value text-success" id="correct-answers">0</h4>
                    <p class="stat-label">Correct Answers</p>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="stat-item">
                    <h4 class="stat-value text-primary" id="time-spent">0s</h4>
                    <p class="stat-label">Total Time Spent</p>
                  </div>
                </div>
              </div>
              <div class="progress mt-4" style="height: 10px">
                <div id="score-progress" class="progress-bar bg-success" 
                     role="progressbar" style="width: 0%"></div>
              </div>
            </div>
          </div>

          <!-- Concept Analysis Section -->
          <div class="concept-analysis card shadow-sm mb-4">
                <div class="card-body">
                <h3 class="card-title mb-4">Concept Analysis</h3>
                
                <!-- Weak Areas -->
                <div class="weak-areas mb-4">
                    <h5>Areas Needing Revision</h5>
                    <div id="weak-concepts" class="d-flex flex-wrap gap-2"></div>
                    <p class="text-muted mt-2">These concepts appeared in questions you answered incorrectly or left unanswered</p>
                </div>
                </div>
            </div>
  
          <!-- Detailed Results -->
          <div class="detailed-results">
            <h3 class="mb-4">Question-wise Analysis</h3>
            <div id="results-container" class="row g-4">
              <!-- Results will be populated here -->
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
          const urlParams = new URLSearchParams(window.location.search);
          const userEmail = urlParams.get('email');
          
          function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger position-fixed top-0 start-50 translate-x mt-3';
            errorDiv.style.zIndex = '9999';
            errorDiv.textContent = message;
            document.body.prepend(errorDiv);
            setTimeout(() => errorDiv.remove(), 5000);
          }
        
          if (!userEmail) {
            showError('No email specified');
            return;
          }
        
          try {
            const response = await fetch(`http://localhost:4000/api/testresponses?email=${encodeURIComponent(userEmail)}`);
            if (!response.ok) throw new Error('Failed to fetch results');
            
            const result = await response.json();
            
            // Update summary
            document.getElementById('total-questions').textContent = result.totalQuestions;
            document.getElementById('correct-answers').textContent = result.correctAnswers;
            document.getElementById('time-spent').textContent = `${result.timeSpent}s`;
            
            // Update progress bar
            const scorePercent = (result.correctAnswers / result.totalQuestions * 100).toFixed(1);
            document.getElementById('score-progress').style.width = `${scorePercent}%`;
        
            // Calculate concept priority scores
            const conceptScores = {};
            const difficultyWeights = { 'easy': 1, 'medium': 1.5, 'hard': 2 };
        
            result.details.forEach(detail => {
              if (detail.userAnswer !== detail.correctAnswer) {
                const concepts = detail.testedConcepts || [];
                const prerequisites = detail.prerequisiteTopics || [];
                
                concepts.forEach(concept => {
                  if (!conceptScores[concept]) {
                    conceptScores[concept] = {
                      count: 0,
                      totalDifficulty: 0,
                      prerequisiteCount: 0
                    };
                  }
                  
                  conceptScores[concept].count++;
                  conceptScores[concept].totalDifficulty += difficultyWeights[detail.difficulty] || 1;
                  conceptScores[concept].prerequisiteCount += prerequisites.length;
                });
              }
            });
        
            // Convert to sorted array with priority scoring
            const sortedConcepts = Object.entries(conceptScores)
              .map(([concept, scores]) => ({
                concept,
                score: (scores.count * 0.5) + 
                       (scores.totalDifficulty * 0.3) + 
                       (scores.prerequisiteCount * 0.2)
              }))
              .sort((a, b) => b.score - a.score)
              .slice(0, 5);
        
            // Display top concepts
            const weakConceptsContainer = document.getElementById('weak-concepts');
            if (sortedConcepts.length > 0) {
              sortedConcepts.forEach(({concept, score}) => {
                const pill = document.createElement('div');
                pill.className = 'concept-pill';
                pill.innerHTML = `
                  <a href="/concepts/${encodeURIComponent(concept)}" 
                     class="concept-link"
                     title="Priority score: ${score.toFixed(1)}">
                    ${concept}
                  </a>
                `;
                weakConceptsContainer.appendChild(pill);
              });
            } else {
              weakConceptsContainer.innerHTML = `
                <div class="alert alert-info mb-0">
                  Great work! No significant weak areas detected.
                </div>
              `;
            }
        
            // Populate detailed results with actual values
            const container = document.getElementById('results-container');
            result.details.forEach((detail, index) => {
              const isCorrect = detail.userAnswer === detail.correctAnswer;
              
              // Helper function to get actual answer value
              const getAnswerValue = (optionKey) => {
                if (!optionKey || !detail.questionOptions) return 'Unanswered';
                const optionMap = {
                  'a': 'optionA',
                  'b': 'optionB',
                  'c': 'optionC',
                  'd': 'optionD'
                };
                return detail.questionOptions[optionMap[optionKey.toLowerCase()]] || 'Unanswered!';
              };
        
              const card = document.createElement('div');
              card.className = 'col-12';
              card.innerHTML = `
                <div class="question-card card shadow-sm mb-3">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h5 class="card-title">Question ${index + 1}</h5>
                      <span class="badge ${isCorrect ? 'bg-success' : 'bg-danger'}">
                        ${isCorrect ? 'Correct' : 'Incorrect'}
                      </span>
                    </div>
                    <p class="question-text mb-3">${detail.question}</p>
                    <div class="row">
                      <div class="col-md-4">
                        <p><strong>Your Answer:</strong> 
                          <span class="${isCorrect ? 'text-success' : 'text-danger'}">
                            ${getAnswerValue(detail.userAnswer)}
                          </span>
                        </p>
                      </div>
                      <div class="col-md-4">
                        <p><strong>Correct Answer:</strong> 
                          <span class="text-success">
                            ${getAnswerValue(detail.correctAnswer)}
                          </span>
                        </p>
                      </div>
                      <div class="col-md-4">
                        <p><strong>Time Spent:</strong> ${detail.timeSpent}s</p>
                      </div>
                    </div>
                    ${detail.explanation ? `
                    <div class="explanation mt-3 p-3 bg-light rounded">
                      <h6>Explanation:</h6>
                      <p class="mb-0">${detail.explanation}</p>
                    </div>
                    ` : ''}
                    ${detail.testedConcepts?.length ? `
                    <div class="concepts mt-3">
                      <h6>Tested Concepts:</h6>
                      <div class="d-flex flex-wrap gap-2">
                        ${detail.testedConcepts.map(c => `
                            <span class="badge tested-concept-badge">${c}</span>
                        `).join('')}
                      </div>
                    </div>
                    ` : ''}
                  </div>
                </div>
              `;
              container.appendChild(card);
            });
        
          } catch (error) {
            showError(`Failed to load results: ${error.message}`);
          }
        });
        </script>

<footer id="footer" class="footer position-relative">
    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="../index.html" class="logo d-flex align-items-center">
            <span class="">Sanghamitra Learning</span>
          </a>
          <div class="footer-contact pt-3">
            <p>GacchiBowli</p>
            <p>Hyderabad, TS 500032</p>
            <p class="mt-3"><strong>Phone:</strong> <span>+91 7020102729</span></p>
            <p><strong>Email:</strong> <span>sanghamitra.learnworlds@gmail.com</span></p>
          </div>
          <div class="social-links d-flex mt-4">
            <a href=""><i class="bi bi-twitter"></i></a>
            <a href=""><i class="bi bi-facebook"></i></a>
            <a href=""><i class="bi bi-instagram"></i></a>
            <a href=""><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
  
        <div class="col-lg-4 col-md-12 footer-newsletter">
          
        </div>
  
      </div>
    </div>
  
    <div class="container copyright text-center mt-4">
      <p>Â© <span>Copyright</span> <strong class="px-1">Sanghamitra Learning</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you've purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: [buy-url] -->
        Designed by <a href="../index.html">Sanghamitra</a>
      </div>
    </div>
  
  </footer>
  
  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
  
  <!-- Preloader -->
  <div id="preloader"></div>
  
  <!-- Vendor JS Files -->
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>
  <script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="../assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>
  
  <!-- Main JS File -->
  <script src="../assets/js/main.js"></script>
  <script src="../navbar.js"></script>
  
  </body>
  
  </html>
