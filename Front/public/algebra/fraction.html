<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fractions Practice</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="../assets/css/main.css" rel="stylesheet">

  <!-- Custom CSS for Fractions Practice -->
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      margin: 0;
      padding: 0;
    }

    .header, .main, .footer {
      display: block;
      width: 100%;
    }

    .page {
      display: none;
      text-align: center;
    }

    .page.active {
      display: block;
    }

    .quiz-container {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      max-width: 800px;
      margin: 20px auto;
      background-color: #f9f9f9;
    }

    #options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .option {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #fff;
      cursor: pointer;
      transition: background-color 0.3s;
      color: black;
    }

    .option.selected {
      background-color: #5fcf80;
    }

    .option.correct {
      background-color: #d4edda;
      border-color: #c3e6cb;
      color: #155724;
    }

    .option.incorrect {
      background-color: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }

    .option.correct::before {
      content: "✔ ";
      color: #155724;
    }

    .option.incorrect::before {
      content: "✖ ";
      color: #721c24;
    }

    .option:hover {
      background-color: #e6e6e6;
    }

    .buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    /* Specific rules for Next and Previous buttons */
    #next-button, #previous-button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #5fcf80; /* New background color */
      color: rgb(10, 10, 10);
      transition: background-color 0.3s;
    }

    #next-button:hover, #previous-button:hover {
      background-color: #e6e6e6; /* New hover background color */
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #007bff; /* Original background color */
      color: white;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #525456; /* Hover background color */
    }

    #feedback {
      text-align: left;
      margin-top: 20px;
    }

    #feedback p {
      margin: 5px 0;
    }

    .hidden {
      display: none;
    }

    #comprehensive-analysis {
      margin-top: 20px;
      text-align: left;
    }

    .analysis-question {
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      background-color: #f9f9f9;
    }

    .question-header {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .correct-icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      background-color: #28a745;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 20px;
      margin-right: 10px;
      position: relative;
    }

    .correct-icon::after {
      content: "✔";
      color: white;
      font-weight: bold;
      position: absolute;
      top: 0;
      left: 5px;
      font-size: 14px;
    }

    .incorrect-icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      background-color: #dc3545;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 20px;
      margin-right: 10px;
      position: relative;
    }

    .incorrect-icon::after {
      content: "✖";
      color: white;
      font-weight: bold;
      position: absolute;
      top: 0;
      left: 5px;
      font-size: 14px;
    }

    .skipped-icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      background-color: #6c757d;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 20px;
      margin-right: 10px;
      position: relative;
    }

    .skipped-icon::after {
      content: "❔";
      color: white;
      font-weight: bold;
      position: absolute;
      top: 0;
      left: 5px;
      font-size: 14px;
    }
    .question-nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
    }

    .question-nav .question-circle {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .question-nav .question-circle.active {
      background-color: #5fcf80;
      color: #fff;
    }
    .question-nav .question-circle.attempted::after {
      content: "✔";
      color: #5fcf80;
      font-weight: bold;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">
      <a href="../index.html" class="logo d-flex align-items-center me-auto">
        <img src="../img/sbi.logo.png" alt="Logo" width="80" height="80">
        <h1 class="">Sanghamitra Learning</h1>
      </a>
      <nav id="navmenu" class="navmenu">
        <div id="navbar-placeholder"></div>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
    </div>
  </header>

  <main id="main-content" class="main">
    <div class="quiz-container">
      <h1>Fractions Practice</h1>
      <p id="difficulty"></p>
      <p id="question" class="h4"></p>
      <div id="options"></div>
      <button id="submit-button" class="btn btn-primary mt-3 hidden" onclick="showExplanation()">Submit</button>
      <div id="feedback" class="hidden">
        <p id="explanation-text" class="mt-3"></p>
        <p id="correct-option" class="mt-2" style="color: green;"></p>
        <button id="next-button" class="btn btn-secondary mt-3" onclick="fetchQuestion()">Next</button>
      </div>
      <button id="next-topic" class="btn btn-info mt-3 hidden" onclick="location.href='decimals_assessment.html'">Next Topic: Decimals</button>
    </div>
  </main>

  <footer id="footer" class="footer position-relative">
    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="">Sanghamitra Learning</span>
          </a>
          <div class="footer-contact pt-3">
            <p>GacchiBowli</p>
            <p>Hyderabad, TS 500032</p>
            <p class="mt-3"><strong>Phone:</strong> <span>+91 7020102729</span></p>
            <p><strong>Email:</strong> <span>sanghamitra.learnworlds@gmail.com</span></p>
          </div>
          <div class="social-links d-flex mt-4">
            <a href=""><i class="bi bi-twitter"></i></a>
            <a href=""><i class="bi bi-facebook"></i></a>
            <a href=""><i class="bi bi-instagram"></i></a>
            <a href=""><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
        <div class="col-lg-4 col-md-12 footer-newsletter"></div>
      </div>
    </div>
    <div class="container copyright text-center mt-4">
      <p>© <span>Copyright</span> <strong class="px-1">Sanghamitra Learning</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        Designed by <a href="index.html">Sanghamitra</a>
      </div>
    </div>
  </footer>

  <script>
    let username = '';
    let email = '';
    let currentQuestion = null;
    let selectedOption = null;

    async function fetchSessionInfo() {
      try {
        const response = await fetch('https://sanghamitra-learnworld.vercel.app/api/session-info');
        if (response.ok) {
          const data = await response.json();
          username = data.username;
          email = data.email;
          console.log(username, email);
        } else {
          console.error('Failed to fetch session info');
        }
      } catch (error) {
        console.error('Error fetching session info:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await fetchSessionInfo();
      fetchQuestion();
    });

    const topic = 'fractions';
    let difficultyLevel = 'hard';
    let consecutiveCorrect = 0;
    let answeredQuestions = [];

    async function fetchQuestion() {
      document.getElementById('feedback').classList.add('hidden');
      document.getElementById('submit-button').classList.add('hidden');
      document.getElementById('submit-button').disabled = false;
      document.getElementById('correct-option').innerText = '';
      const optionsDiv = document.getElementById('options');
      optionsDiv.innerHTML = '';

      const response = await fetch(`https://sanghamitra-learnworld.vercel.app/api/algebra_questions?topic=${topic}&difficultyLevel=${difficultyLevel}`);
      const questions = await response.json();
      const question = questions.find(q => !answeredQuestions.includes(q._id));

      if (question) {
        currentQuestion = question;
        selectedOption = null;
        document.getElementById('difficulty').innerText = `Difficulty: ${difficultyLevel}`;
        document.getElementById('question').innerText = question.question;

        for (const [key, value] of Object.entries(question.options)) {
          const button = document.createElement('button');
          button.classList.add('option', 'btn', 'btn-outline-secondary');
          button.innerText = value;
          button.onclick = () => selectOption(button, key === question.correctOption, question);
          optionsDiv.appendChild(button);
        }
      } else {
        alert('No more questions available for this topic.');
      }
    }

    function selectOption(button, correct, question) {
      if (selectedOption) {
        selectedOption.classList.remove('selected');
      }
      selectedOption = button;
      button.classList.add('selected');
      button.dataset.correct = correct;
      document.getElementById('submit-button').classList.remove('hidden');
    }

    async function showExplanation() {
      const correct = selectedOption && selectedOption.dataset.correct === 'true';
      answeredQuestions.push(currentQuestion._id);
      await fetch('https://sanghamitra-learnworld.vercel.app/api/algebra_score_add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username,
          email,
          topics: [
            {
              topic,
              questions: [
                {
                  questionId: currentQuestion._id,
                  answer: selectedOption ? selectedOption.innerText : 'no_answer',
                  correct,
                  difficultyLevel
                }
              ]
            }
          ]
        })
      });

      document.getElementById('feedback').classList.remove('hidden');
      document.getElementById('explanation-text').innerText = currentQuestion.explanation;

      // Disable the submit button
      document.getElementById('submit-button').disabled = true;
      document.getElementById('submit-button').classList.add('hidden');

      // Disable all option buttons and show correct option in green
      document.querySelectorAll('.option').forEach(button => {
        button.disabled = true;
        if (button.dataset.correct === 'true') {
          button.classList.add('correct');
        }
      });

      document.getElementById('correct-option').innerText = `Correct Option: ${currentQuestion.options[currentQuestion.correctOption]}`;

      if (correct) {
        if (difficultyLevel === 'hard') consecutiveCorrect++;
        difficultyLevel = difficultyLevel === 'easy' ? 'medium' : 'hard';
      } else {
        consecutiveCorrect = 0;
        difficultyLevel = difficultyLevel === 'hard' ? 'medium' : 'easy';
      }

      if (consecutiveCorrect === 4) {
        document.getElementById('next-topic').classList.remove('hidden');
      }
    }
  </script>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>
  <script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="../assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS File -->
  <script src="../assets/js/main.js"></script>
  <script src="../navbar.js"></script>
</body>
</html>
