<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fractions Practice</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="../assets/css/main.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Open Sans', sans-serif;
    }
    #main-content {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 80vh;
    }
    #question-container {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 100%;
      text-align: center;
    }
    .option-button {
      display: block;
      width: 100%;
      margin: 10px 0;
    }
    #explanation {
      margin-top: 20px;
    }
    .selected {
      background-color: #007bff; /* Bootstrap primary color */
      color: white;
    }
    .correct {
      background-color: green;
      color: white;
    }
    .incorrect {
      background-color: red;
      color: white;
    }
  </style>
</head>

<body>
  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">

      <a href="../index.html" class="logo d-flex align-items-center me-auto">
        <img src="../img/sbi.logo.png" alt="Logo" width="80" height="80"> 
        <h1 class="">Sanghamitra Learning</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <div id="navbar-placeholder"></div>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

    </div>
  </header>

  <main id="main-content" class="main">
    <div id="question-container">
      <h1>Fractions Practice</h1>
      <p id="difficulty"></p>
      <p id="question" class="h4"></p>
      <div id="options"></div>
      <button id="submit-button" class="btn btn-primary mt-3" style="display: none;" onclick="showExplanation()">Submit</button>
      <div id="explanation" style="display: none;">
        <p id="explanation-text" class="mt-3"></p>
        <p id="correct-option" class="mt-2" style="color: green;"></p>
        <button id="next-button" class="btn btn-secondary mt-3" onclick="fetchQuestion()">Next</button>
      </div>
      <button id="next-topic" class="btn btn-info mt-3" style="display: none;" onclick="location.href='decimals_assessment.html'">Next Topic: Decimals</button>
    </div>
  </main>

  <footer id="footer" class="footer position-relative">
    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="">Sanghamitra Learning</span>
          </a>
          <div class="footer-contact pt-3">
            <p>GacchiBowli</p>
            <p>Hyderabad, TS 500032</p>
            <p class="mt-3"><strong>Phone:</strong> <span>+91 7020102729</span></p>
            <p><strong>Email:</strong> <span>sanghamitra.learnworlds@gmail.com</span></p>
          </div>
          <div class="social-links d-flex mt-4">
            <a href=""><i class="bi bi-twitter"></i></a>
            <a href=""><i class="bi bi-facebook"></i></a>
            <a href=""><i class="bi bi-instagram"></i></a>
            <a href=""><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>Â© <span>Copyright</span> <strong class="px-1">Sanghamitra Learning</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you've purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: [buy-url] -->
        Designed by <a href="index.html">Sanghamitra</a>
      </div>
    </div>
  </footer>
  
  <script>
    let username = '';
    let email = '';
    let currentQuestion = null;
    let selectedOption = null;

    async function fetchSessionInfo() {
      try {
        const response = await fetch('https://sanghamitra-learnworld.vercel.app/api/session-info');
        if (response.ok) {
          const data = await response.json();
          username = data.username;
          email = data.email;
          console.log(username, email);
        } else {
          console.error('Failed to fetch session info');
        }
      } catch (error) {
        console.error('Error fetching session info:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await fetchSessionInfo();
      fetchQuestion();
    });

    const topic = 'fractions';
    let difficultyLevel = 'hard';
    let consecutiveCorrect = 0;
    let answeredQuestions = [];

    async function fetchQuestion() {
      document.getElementById('explanation').style.display = 'none';
      const response = await fetch(`https://sanghamitra-learnworld.vercel.app/api/algebra_questions?topic=${topic}&difficultyLevel=${difficultyLevel}`);
      const questions = await response.json();
      const question = questions.find(q => !answeredQuestions.includes(q._id));

      if (question) {
        currentQuestion = question;
        selectedOption = null;
        document.getElementById('difficulty').innerText = `Difficulty: ${difficultyLevel}`;
        document.getElementById('question').innerText = question.question;

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = '';
        for (const [key, value] of Object.entries(question.options)) {
          const button = document.createElement('button');
          button.classList.add('btn', 'btn-outline-primary', 'option-button');
          button.innerText = value;
          button.onclick = () => selectOption(button, key === question.correctOption, question);
          optionsDiv.appendChild(button);
        }
      } else {
        alert('No more questions available for this topic.');
      }
    }

    function selectOption(button, correct, question) {
      // Deselect previously selected option
      if (selectedOption) {
        selectedOption.classList.remove('selected');
      }
      // Select the new option
      selectedOption = button;
      button.classList.add('selected');
      // Show the submit button
      document.getElementById('submit-button').style.display = 'block';
    }

    async function showExplanation() {
      // Disable all option buttons
      document.querySelectorAll('.option-button').forEach(button => button.disabled = true);
    
      // Check if the selected option is correct
      const correct = selectedOption.textContent === currentQuestion.options[currentQuestion.correctOption];
      
      // Show the selected option in green if correct, red if incorrect
      selectedOption.classList.remove('selected');
      selectedOption.classList.add(correct ? 'correct' : 'incorrect');
    
      // Show the correct answer in green
      if (!correct) {
        document.querySelectorAll('.option-button').forEach(button => {
          if (button.textContent === currentQuestion.options[currentQuestion.correctOption]) {
            button.classList.add('correct');
          }
        });
      }
      // Hide the submit button
      document.getElementById('submit-button').style.display = 'none';

    
      answeredQuestions.push(currentQuestion._id);
      await fetch('https://sanghamitra-learnworld.vercel.app/api/algebra_score_add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username,
          email,
          topics: [
            {
              topic,
              questions: [
                {
                  questionId: currentQuestion._id,
                  answer: correct ? currentQuestion.correctOption : 'user_answer',
                  correct,
                  difficultyLevel
                }
              ]
            }
          ]
        })
      });

      document.getElementById('explanation').style.display = 'block';
      document.getElementById('explanation-text').innerText = currentQuestion.explanation;
      if (!correct) {
        document.getElementById('correct-option').innerText = `Correct Option: ${currentQuestion.options[currentQuestion.correctOption]}`;
      } else {
        document.getElementById('correct-option').innerText = '';
      }

      if (correct) {
        if (difficultyLevel === 'hard') consecutiveCorrect++;
        difficultyLevel = difficultyLevel === 'easy' ? 'medium' : 'hard';
      } else {
        consecutiveCorrect = 0;
        difficultyLevel = difficultyLevel === 'hard' ? 'medium' : 'easy';
      }

      if (consecutiveCorrect === 4) {
        document.getElementById('next-topic').style.display = 'block';
      }
    }
  </script>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>
  <script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="../assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS File -->
  <script src="../assets/js/main.js"></script>
  <script src="../navbar.js"></script>
</body>
</html>
