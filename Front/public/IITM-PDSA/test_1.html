<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Programming Quiz</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(90, 65, 65, 0.1);
            overflow: hidden;
        }
    
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .quiz-container { padding: 30px; }

        .question-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
        }


        .test-cases {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
        }

        .test-passed {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .test-failed {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .btn:hover { transform: translateY(-2px); }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 8px;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .score-display {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .results-container { display: none; padding: 30px; }
        .loading { display: none; }
        
        .explanation-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .option-label {
            display: block;
            padding: 12px 15px;
            margin: 8px 0;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-label:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .option-label.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .numerical-input {
            width: 200px;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 0;
        }

        .numerical-input:focus {
            border-color: #667eea;
            outline: none;
        }

        .code-block {
            background: #5ebe66;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            padding: 12px 30px !important;
            border-radius: 8px !important;
            font-size: 16px !important;
        }
        
        .btn-success:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêç Python Programming Quiz</h1>
            <p>Test your knowledge of Python programming concepts, functions, and logic</p>
        </div>

        <!-- Loading Screen -->
        <div id="loadingScreen" class="quiz-container" style="text-align: center; padding: 60px;">
            <div class="loading" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
            <h3>Loading Quiz...</h3>
            <p>Preparing your test environment</p>
        </div>

        <!-- Quiz Container -->
        <div id="quizContainer" class="quiz-container" style="display: none;">
            <div class="progress-container mb-4">
                <div class="d-flex justify-content-between mb-2">
                    <span id="progressText">Question 1 of 50</span>
                    
                </div>
                <div class="progress">
                    <div class="progress-bar" id="progressFill" style="width: 2%;"></div>
                </div>
            </div>
            
            <div id="questionContainer"></div>
            
            <div class="d-flex justify-content-between mt-4">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>‚Üê Previous</button>
                <div>
                    <button class="btn" id="nextBtn" onclick="nextQuestion()">Next ‚Üí</button>
                    <button class="btn btn-success" onclick="submitQuiz()" id="submitBtn" style="display: none;">
                        üìä Submit Quiz
                    </button>
                </div>
            </div>
            
            
        </div>

        <!-- Results -->
        <div id="resultsContainer" class="results-container">
            <div class="score-display">
                <h2 id="finalScore">0/50</h2>
                <h3 id="finalPercentage">0%</h3>
                <p>Quiz Completed!</p>
            </div>
            <div id="detailedResults"></div>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <!-- Left: Take Quiz Again -->
                 <button class="btn btn-outline-secondary" onclick="goToHome()">
                    <span class="d-flex align-items-center">
                        <span class="me-2">‚Üê</span>
                        <span> Go to Home</span>
                    </span>
                </button>
                <!-- Right: Go to Home -->
                <button class="btn btn-primary" onclick="restartQuiz()">
                    <span class="d-flex align-items-center">
                        <span class="me-2">üîÑ</span>
                        <span>Retake Quiz</span>
                    </span>
                </button>
            </div>
            
        </div>
    </div>

    <script>

        const questions = [
            {
                questionId: 1,
                title: "Function check() Analysis",
                type: "mcq-single",
                description: "Given the following function, what does it check?",
                code: `def check(n):
    while n != 0:
        d = n % 10
        if d % 2 != 1:
            return False
        n = n // 10
    return True`,
                options: [
                    "Function check returns True if the number of digits in n is odd.",
                    "Function check returns True if all digits of n are even.",
                    "Function check returns True if all digits of n are odd.",
                    "Function check returns True if the number of digits in n is even."
                ],
                correctAnswer: "Function check returns True if all digits of n are odd.",
                maxScore: 2,
                hasExplanations: true,
                explanation: "The function checks each digit (d = n % 10). If any digit is even (d % 2 != 1), it returns False. Only if all digits are odd, it returns True."
            },
            {
                questionId: 2,
                title: "Loop Execution Value",
                type: "mcq-single",
                description: "What will be the value of i after execution of the given code snippet?",
                code: `x = range(5)
s = 0
for i in x:
    s += i`,
                options: ["2", "4", "5", "Error"],
                correctAnswer: "4",
                maxScore: 2,
                hasExplanations: true,
                explanation: "range(5) produces 0,1,2,3,4. After the loop finishes, i retains the last value, which is 4."
            },
            {
                questionId: 3,
                title: "List Comprehension Output",
                type: "mcq-single",
                description: "What does this list comprehension produce?",
                code: `result = [x**2 for x in range(5) if x % 2 == 0]`,
                options: [
                    "[0, 1, 4, 9, 16]",
                    "[0, 4, 16]",
                    "[1, 9]",
                    "[0, 2, 4]"
                ],
                correctAnswer: "[0, 4, 16]",
                maxScore: 2,
                hasExplanations: true,
                explanation: "range(5) = 0,1,2,3,4. Filter x%2==0 gives 0,2,4. Square of these: 0¬≤=0, 2¬≤=4, 4¬≤=16."
            },
            {
                questionId: 4,
                title: "Dictionary Comprehension",
                type: "mcq-single",
                description: "What is the output of this dictionary comprehension?",
                code: `d = {x: x*2 for x in range(1, 4)}`,
                options: [
                    "{1: 2, 2: 4, 3: 6}",
                    "{0: 0, 1: 2, 2: 4}",
                    "{1: 1, 2: 2, 3: 3}",
                    "{2: 1, 4: 2, 6: 3}"
                ],
                correctAnswer: "{1: 2, 2: 4, 3: 6}",
                maxScore: 2,
                hasExplanations: true,
                explanation: "range(1,4) gives 1,2,3. For each x, key=x, value=x*2. So: 1:2, 2:4, 3:6."
            },
            {
                questionId: 5,
                title: "String Slicing",
                type: "mcq-single",
                description: "What does s[::-1] do?",
                code: `s = "python"
result = s[::-1]`,
                options: [
                    "Returns the original string",
                    "Reverses the string",
                    "Returns every second character",
                    "Returns empty string"
                ],
                correctAnswer: "Reverses the string",
                maxScore: 2,
                hasExplanations: true,
                explanation: "The slice [::-1] means start from end, go to start, step -1 (backwards). This reverses the string."
            },
            {
                questionId: 6,
                title: "Function Default Arguments",
                type: "mcq-single",
                description: "What is the output of this code?",
                code: `def func(a, b=[]):
    b.append(a)
    return b

print(func(1))
print(func(2))`,
                options: [
                    "[1] then [2]",
                    "[1] then [1, 2]",
                    "[1, 2] then [1, 2]",
                    "Error"
                ],
                correctAnswer: "[1] then [1, 2]",
                maxScore: 2,
                hasExplanations: true,
                explanation: "Default argument b=[] is evaluated only once when function is defined. So both calls modify the same list."
            },
            {
                questionId: 7,
                title: "Lambda Function",
                type: "mcq-single",
                description: "What does this lambda function return?",
                code: `f = lambda x: x + 5
result = f(10)`,
                options: ["5", "10", "15", "50"],
                correctAnswer: "15",
                maxScore: 2,
                hasExplanations: true,
                explanation: "Lambda creates an anonymous function that adds 5 to its argument. f(10) = 10 + 5 = 15."
            },
            {
                questionId: 8,
                title: "List Operations",
                type: "mcq-single",
                description: "What is the result of this list operation?",
                code: `a = [1, 2, 3]
b = a
b.append(4)
print(a)`,
                options: [
                    "[1, 2, 3]",
                    "[1, 2, 3, 4]",
                    "[4, 3, 2, 1]",
                    "Error"
                ],
                correctAnswer: "[1, 2, 3, 4]",
                maxScore: 2,
                hasExplanations: true,
                explanation: "b = a makes b reference the same list object as a. Modifying b also modifies a."
            },
            {
                questionId: 9,
                title: "Set Operations",
                type: "mcq-single",
                description: "What is the output of this set operation?",
                code: `A = {1, 2, 3}
B = {3, 4, 5}
result = A & B`,
                options: [
                    "{1, 2, 3, 4, 5}",
                    "{3}",
                    "{1, 2}",
                    "{4, 5}"
                ],
                correctAnswer: "{3}",
                maxScore: 2,
                hasExplanations: true,
                explanation: "& operator performs intersection. Common element between {1,2,3} and {3,4,5} is {3}."
            },
            {
                questionId: 10,
                title: "List Sum Calculation",
                type: "numerical",
                description: "What is the sum of this list?",
                code: `numbers = [1, 2, 3, 4, 5]
total = 0
for num in numbers:
    if num % 2 == 0:
        total += num`,
                correctAnswer: 6,
                maxScore: 2,
                hasExplanations: true,
                explanation: "Loop adds only even numbers: 2 + 4 = 6."
            },
            {
                questionId: 11,
                title: "Recursive Function",
                type: "mcq-single",
                description: "What does this recursive function compute?",
                code: `def fact(n):
    if n == 0:
        return 1
    else:
        return n * fact(n-1)`,
                options: [
                    "Fibonacci number",
                    "Factorial",
                    "Sum of numbers",
                    "Power calculation"
                ],
                correctAnswer: "Factorial",
                maxScore: 2,
                hasExplanations: true,
                explanation: "This is the classic recursive implementation of factorial: n! = n √ó (n-1)!"
            },
            {
                questionId: 12,
                title: "String Method Output",
                type: "mcq-single",
                description: "What does split() without arguments do?",
                code: `s = "Hello World Python"
result = s.split()`,
                options: [
                    "Splits on commas",
                    "Splits on whitespace",
                    "Splits every character",
                    "Returns original string"
                ],
                correctAnswer: "Splits on whitespace",
                maxScore: 2,
                hasExplanations: true,
                explanation: "split() without arguments splits on any whitespace and removes empty strings."
            },
            {
                questionId: 13,
                title: "Tuple Unpacking",
                type: "mcq-single",
                description: "What is the value of b after this code?",
                code: `a, b, c = (1, 2, 3)`,
                options: ["1", "2", "3", "Error"],
                correctAnswer: "2",
                maxScore: 2,
                hasExplanations: true,
                explanation: "Tuple unpacking assigns first value to a, second to b, third to c. So b = 2."
            },
            {
                questionId: 14,
                title: "While Loop Iterations",
                type: "numerical",
                description: "How many times does this loop execute?",
                code: `count = 0
i = 5
while i > 0:
    count += 1
    i -= 1`,
                correctAnswer: 5,
                maxScore: 2,
                hasExplanations: true,
                explanation: "i starts at 5, decrements by 1 each iteration, loop stops when i = 0. Iterations: 5,4,3,2,1 = 5 times."
            },
            {
                questionId: 15,
                title: "List Reverse Indexing",
                type: "mcq-single",
                description: "What does lst[-1] return?",
                code: `lst = [10, 20, 30, 40, 50]
result = lst[-1]`,
                options: ["10", "20", "40", "50"],
                correctAnswer: "50",
                maxScore: 2,
                hasExplanations: true,
                explanation: "Negative indices count from the end: -1 is last element, -2 is second last, etc."
            },
            {
                questionId: 16,
                title: "Function Scope",
                type: "mcq-single",
                description: "What is the output?",
                code: `x = 10
def change():
    x = 20
change()
print(x)`,
                options: ["10", "20", "Error", "None"],
                correctAnswer: "10",
                maxScore: 2,
                hasExplanations: true,
                explanation: "x inside function is local variable, doesn't affect global x. So global x remains 10."
            },
            {
                questionId: 17,
                title: "String Formatting",
                type: "mcq-single",
                description: "What does this f-string produce?",
                code: `name = "Alice"
age = 25
result = f"{name} is {age} years old."`,
                options: [
                    "Alice is 25 years old.",
                    "{name} is {age} years old.",
                    "name is age years old.",
                    "Error"
                ],
                correctAnswer: "Alice is 25 years old.",
                maxScore: 2,
                hasExplanations: true,
                explanation: "f-strings evaluate expressions inside {} and insert their values into the string."
            },
            {
                questionId: 18,
                title: "Dictionary Key Access",
                type: "mcq-single",
                description: "What does dict.get() do if key doesn't exist?",
                code: `d = {'a': 1, 'b': 2}
result = d.get('c', 0)`,
                options: [
                    "Raises KeyError",
                    "Returns None",
                    "Returns 0",
                    "Returns 'c'"
                ],
                correctAnswer: "Returns 0",
                maxScore: 2,
                hasExplanations: true,
                explanation: "get(key, default) returns the value for key if it exists, otherwise returns default (0 in this case)."
            },
            {
                questionId: 19,
                title: "List Filter with Lambda",
                type: "mcq-single",
                description: "What does this filter operation produce?",
                code: `nums = [1, 2, 3, 4, 5, 6]
result = list(filter(lambda x: x > 3, nums))`,
                options: [
                    "[1, 2, 3]",
                    "[4, 5, 6]",
                    "[3, 4, 5, 6]",
                    "[1, 2]"
                ],
                correctAnswer: "[4, 5, 6]",
                maxScore: 2,
                hasExplanations: true,
                explanation: "filter keeps elements where lambda returns True. lambda x: x > 3 keeps numbers > 3: 4,5,6."
            },
            {
                questionId: 20,
                title: "Range Step Value",
                type: "numerical",
                description: "What is the last number in this range?",
                code: `r = range(0, 10, 2)
last = list(r)[-1]`,
                correctAnswer: 8,
                maxScore: 2,
                hasExplanations: true,
                explanation: "range(0,10,2) generates 0,2,4,6,8 (up to but not including 10). Last element is 8."
            },



            {
    "questionId": 21,
    "title": "Recursive Function Computation",
    "type": "mcq-single",
    "description": "What does the function 'fun' compute?",
    "code": `def fun(m, n):
    if m == n:
        return n
    else:
        if m > n:
            return fun(m - n, n)
        else:
            return fun(m, n - m)`,
    "options": [
        "m + n using repeated subtraction",
        "m mod n using repeated subtraction",
        "The greatest common divisor of m and n",
        "The least common multiple of m and n"
    ],
    "correctAnswer": "The greatest common divisor of m and n",
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "This is Euclid's subtraction algorithm for finding the greatest common divisor (GCD). When m = n, the GCD is m (or n). Otherwise, it recursively subtracts the smaller from the larger until they become equal."
},
{
    "questionId": 22,
    "title": "Prime Function Correct Output",
    "type": "mcq-multiple",
    "description": "The function prime_bad checks for primality but has an error. For which of the following input values will prime_bad return the CORRECT output?",
    "code": `def prime_bad(n):
    if n < 2:
        return False
    for i in range(2, int(n**0.5)):
        if n % i == 0:
            return False
    return True`,
    "options": [
        "36",
        "29",
        "49",
        "37"
    ],
    "correctAnswer": ["29", "37"],
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "The bug is in the range: range(2, int(n**0.5)) excludes the square root when n is a perfect square. For n=36: range(2,6) checks divisors 2-5, missing 6 ‚Üí incorrectly returns True. For n=49: range(2,7) checks 2-6, missing 7 ‚Üí incorrectly returns True. For n=29 and n=37, they are prime and the missing divisor check doesn't matter ‚Äî correct output."
},
{
    "questionId": 23,
    "title": "Recursive Digit Counter",
    "type": "mcq-single",
    "description": "What does the function fun(n) compute?",
    "code": `def fun(n):
    if n == 0:
        return 0
    if (n % 10 % 2 == 1):
        return 1 + fun(n // 10)
    else:
        return fun(n // 10)`,
    "options": [
        "Number of even digits",
        "Sum of even digits", 
        "Sum of odd digits",
        "Number of odd digits"
    ],
    "correctAnswer": "Number of odd digits",
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "The function recursively processes digits of n from right to left. The condition (n % 10 % 2 == 1) checks if the last digit (n % 10) is odd. If it is, it adds 1 to the count and continues with the remaining digits (n // 10). If the digit is even, it just continues with the remaining digits without adding to the count. The base case returns 0 when n becomes 0. Therefore, the function counts the total number of odd digits in the input number."
},
{
        "questionId": 24,
        "title": "String Methods",
        "type": "mcq-single",
        "description": "What does the upper() method do to a string?",
        "code": `text = "hello"
result = text.upper()
print(result)`,
        "options": [
            "Converts to lowercase",
            "Converts to uppercase",
            "Capitalizes first letter",
            "Reverses the string"
        ],
        "correctAnswer": "Converts to uppercase",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "The upper() string method returns a copy of the string with all alphabetic characters converted to uppercase. 'hello' becomes 'HELLO'."
    },
{
    "questionId": 25,
    "title": "Recursive Call Count",
    "type": "numerical",
    "description": "For the recursive function fun(n), how many recursive calls are made (excluding the initial call to fun(4))?",
    "code": `def fun(n):
    if n <= 1:
        return 0
    return fun(n - 1) + fun(n - 2)`,
    "correctAnswer": 7,
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "Let's trace fun(4):\nfun(4) calls fun(3) and fun(2)\nfun(3) calls fun(2) and fun(1)\nfun(2) calls fun(1) and fun(0)\nfun(2) from fun(4) calls fun(1) and fun(0)\n\nRecursive call tree:\nfun(4) [initial, excluded]\n‚îú‚îÄ‚îÄ fun(3) [1st]\n‚îÇ   ‚îú‚îÄ‚îÄ fun(2) [2nd]\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fun(1) [3rd] ‚Üí returns 0\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fun(0) [4th] ‚Üí returns 0\n‚îÇ   ‚îî‚îÄ‚îÄ fun(1) [5th] ‚Üí returns 0\n‚îî‚îÄ‚îÄ fun(2) [6th]\n    ‚îú‚îÄ‚îÄ fun(1) [7th] ‚Üí returns 0\n    ‚îî‚îÄ‚îÄ fun(0) [8th] ‚Üí returns 0\n\nTotal recursive calls (excluding initial fun(4)): 7 calls\nNote: fun(1) and fun(0) are base cases but still count as recursive calls when invoked."
},
{
    "questionId": 26,
    "title": "Object Reference and Modification",
    "type": "mcq-multiple",
    "description": "Given the Box class and code, select all correct statements:",
    "code": `class Box:
    def __init__(self, size):
        self.size = size
    
    def double(self):
        self.size = self.size * 2

x = Box(9)
y = x
y.double()
x.double()

print(x.size, y.size)`,
    "options": [
        "Output will be 36 36",
        "Output will be 18 18",
        "x and y refer to the same object",
        "x and y are independent copies of objects",
        "Method double() modifies the object in-place"
    ],
    "correctAnswer": ["Output will be 36 36", "x and y refer to the same object", "Method double() modifies the object in-place"],
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "1. x = Box(9) creates object with size=9\n2. y = x makes y reference the same object as x (not a copy)\n3. y.double() modifies the shared object: size becomes 18\n4. x.double() modifies the same object again: size becomes 36\n5. print(x.size, y.size) prints 36 36\n6. The double() method modifies the object's size attribute in-place"
},

{
    "questionId": 27,
    "title": "Recursive Sum Calculation",
    "type": "mcq-single",
    "description": "What does this recursive function return for input 5?",
    "code": `def sum_rec(n):
    if n == 0:
        return 0
    return n + sum_rec(n - 1)

result = sum_rec(5)`,
    "options": ["10", "15", "20", "25"],
    "correctAnswer": "15",
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "sum_rec(5) = 5 + sum_rec(4) = 5 + 4 + sum_rec(3) = 5 + 4 + 3 + sum_rec(2) = 5 + 4 + 3 + 2 + sum_rec(1) = 5 + 4 + 3 + 2 + 1 + sum_rec(0) = 5 + 4 + 3 + 2 + 1 + 0 = 15"
},
{
    "questionId": 28,
    "title": "Recursive Digit Sum",
    "type": "numerical",
    "description": "What is the output of digit_sum(1234)?",
    "code": `def digit_sum(n):
    if n == 0:
        return 0
    return n % 10 + digit_sum(n // 10)

print(digit_sum(1234))`,
    "correctAnswer": 10,
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "digit_sum(1234) = 4 + digit_sum(123) = 4 + 3 + digit_sum(12) = 4 + 3 + 2 + digit_sum(1) = 4 + 3 + 2 + 1 + digit_sum(0) = 4 + 3 + 2 + 1 + 0 = 10"
},

{
    "questionId": 29,
    "title": "Recursive Power Function",
    "type": "mcq-single",
    "description": "What does power(2, 5) return?",
    "code": `def power(base, exp):
    if exp == 0:
        return 1
    return base * power(base, exp - 1)

result = power(2, 5)`,
    "options": ["16", "25", "32", "64"],
    "correctAnswer": "32",
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "power(2, 5) = 2 * power(2, 4) = 2 * 2 * power(2, 3) = 2 * 2 * 2 * power(2, 2) = 2 * 2 * 2 * 2 * power(2, 1) = 2 * 2 * 2 * 2 * 2 * power(2, 0) = 2 * 2 * 2 * 2 * 2 * 1 = 32"
},
{
    "questionId": 30,
    "title": "Fibonacci Recursive Calls",
    "type": "numerical",
    "description": "How many recursive calls are made for fib(5) excluding the initial call?",
    "code": `def fib(n):
    if n <= 1:
        return n
    return fib(n - 1) + fib(n - 2)

fib(5)`,
    "correctAnswer": 14,
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "fib(5) calls: fib(4), fib(3), fib(2), fib(1), fib(0) multiple times. Total recursive calls: fib(4)[1], fib(3)[2], fib(2)[3], fib(1)[5], fib(0)[3] = 14 calls excluding initial fib(5)"
},
{
    "questionId": 31,
    "title": "Recursive Count Digits",
    "type": "mcq-single",
    "description": "What does count_digits(12345) return?",
    "code": `def count_digits(n):
    if n == 0:
        return 0
    return 1 + count_digits(n // 10)

print(count_digits(12345))`,
    "options": ["4", "5", "6", "Error"],
    "correctAnswer": "5",
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "count_digits(12345) = 1 + count_digits(1234) = 1 + 1 + count_digits(123) = 1 + 1 + 1 + count_digits(12) = 1 + 1 + 1 + 1 + count_digits(1) = 1 + 1 + 1 + 1 + 1 + count_digits(0) = 5"
},
{
    "questionId": 32,
    "title": "Recursive List Sum",
    "type": "numerical",
    "description": "What is the output of list_sum([1, 2, 3, 4, 5])?",
    "code": `def list_sum(lst):
    if not lst:
        return 0
    return lst[0] + list_sum(lst[1:])

print(list_sum([1, 2, 3, 4, 5]))`,
    "correctAnswer": 15,
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "list_sum([1,2,3,4,5]) = 1 + list_sum([2,3,4,5]) = 1 + 2 + list_sum([3,4,5]) = 1 + 2 + 3 + list_sum([4,5]) = 1 + 2 + 3 + 4 + list_sum([5]) = 1 + 2 + 3 + 4 + 5 + list_sum([]) = 1 + 2 + 3 + 4 + 5 + 0 = 15"
},
{
    "questionId": 33,
    "title": "Recursive Reverse String",
    "type": "mcq-single",
    "description": "What does reverse_str('hello') return?",
    "code": `def reverse_str(s):
    if len(s) <= 1:
        return s
    return reverse_str(s[1:]) + s[0]

print(reverse_str('hello'))`,
    "options": ["olleh", "hello", "elloh", "olleH"],
    "correctAnswer": "olleh",
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "reverse_str('hello') = reverse_str('ello') + 'h' = (reverse_str('llo') + 'e') + 'h' = ((reverse_str('lo') + 'l') + 'e') + 'h' = (((reverse_str('o') + 'l') + 'l') + 'e') + 'h' = 'olleh'"
},
{
    "questionId": 34,
    "title": "Recursive Factorial Calls",
    "type": "numerical",
    "description": "How many recursive calls for factorial(6) excluding initial?",
    "code": `def factorial(n):
    if n <= 1:
        return 1
    return n * factorial(n - 1)

factorial(6)`,
    "correctAnswer": 5,
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "factorial(6) calls: factorial(5), factorial(4), factorial(3), factorial(2), factorial(1). Total 5 recursive calls excluding the initial factorial(6) call."
},
{
    "questionId": 35,
    "title": "Recursive Binary Search",
    "type": "mcq-single",
    "description": "What does binary_search([1,3,5,7,9], 7) return?",
    "code": `def binary_search(arr, target, low=0, high=None):
    if high is None:
        high = len(arr) - 1
    if low > high:
        return -1
    mid = (low + high) // 2
    if arr[mid] == target:
        return mid
    elif arr[mid] > target:
        return binary_search(arr, target, low, mid - 1)
    else:
        return binary_search(arr, target, mid + 1, high)

result = binary_search([1,3,5,7,9], 7)`,
    "options": ["2", "3", "4", "-1"],
    "correctAnswer": "3",
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "Search for 7 in [1,3,5,7,9]: mid=2 (value=5), 7>5 so search right [7,9], mid=3 (value=7) found at index 3"
},
{
    "questionId": 36,
    "title": "Recursive GCD Calculation",
    "type": "mcq-single",
    "description": "What does gcd(48, 18) return?",
    "code": `def gcd(a, b):
    if b == 0:
        return a
    return gcd(b, a % b)

print(gcd(48, 18))`,
    "options": ["2", "6", "12", "18"],
    "correctAnswer": "6",
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "gcd(48, 18) = gcd(18, 48%18=12) = gcd(12, 18%12=6) = gcd(6, 12%6=0) = 6"
},
{
    "questionId": 37,
    "title": "Exception Handling in Function",
    "type": "mcq-multiple",
    "description": "Given the function special3Bad(L), select all lists L = [n1, n2, n3] (where n1, n2, n3 are integers) for which the function does NOT produce a ZeroDivisionError exception.",
    "code": `def special3Bad(L):
    try:
        if L[0] % L[1] == 0 and L[1] != 0:
            if L[0] / (L[1] ** 2 - L[2]) == 0:
                return True
        return False
    except ZeroDivisionError:
        print('ZeroDivisionError')
    except:
        print('Some other exception occurred')
    else:
        print('No exception occurred')

special3Bad(L)`,
    "options": [
        "L = [4, 2, 8]",
        "L = [4, 2, 4]", 
        "L = [8, 4, 16]",
        "L = [48, 6, 36]",
        "L = [44, 6, 36]"
    ],
    "correctAnswer": ["L = [4, 2, 8]", "L = [44, 6, 36]"],
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "The function does NOT produce ZeroDivisionError when either:\n1. L[0] % L[1] ‚â† 0 (first condition False) OR\n2. L[1]¬≤ - L[2] ‚â† 0 (division by non-zero)\n\nCheck each:\n‚Ä¢ [4,2,8]: 4%2=0‚úì, 2‚â†0‚úì, but 2¬≤-8=-4‚â†0 ‚Üí No ZeroDivisionError ‚úì\n‚Ä¢ [4,2,4]: 4%2=0‚úì, 2‚â†0‚úì, 2¬≤-4=0 ‚Üí ZeroDivisionError ‚úó\n‚Ä¢ [8,4,16]: 8%4=0‚úì, 4‚â†0‚úì, 4¬≤-16=0 ‚Üí ZeroDivisionError ‚úó\n‚Ä¢ [48,6,36]: 48%6=0‚úì, 6‚â†0‚úì, 6¬≤-36=0 ‚Üí ZeroDivisionError ‚úó\n‚Ä¢ [44,6,36]: 44%6=2‚â†0 ‚Üí First condition False ‚Üí No division ‚Üí No ZeroDivisionError ‚úì"
},

    {
        "questionId": 38,
        "title": "Class Constructor Output",
        "type": "mcq-single",
        "description": "What will be the output of the above code-snippet?",
        "code": `class Student:
    def __init__(self, name, grade):
        self.name = name
        self.grade = grade
    
    def display(self):
        print(f'{self.name} scored {self.grade}')

s = Student('Alice', 'A+')
s.display()`,
        "options": [
            "Alice scored A+",
            "Student Alice scored A+", 
            "name scored grade",
            "Alice A+"
        ],
        "correctAnswer": "Alice scored A+",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "The Student object is created with name='Alice' and grade='A+'. The display() method prints using f-string formatting, resulting in 'Alice scored A+'."
    },
    {
        "questionId": 39,
        "title": "Method Modification Output",
        "type": "mcq-single", 
        "description": "What will be the output of the above code?",
        "code": `class Counter:
    def __init__(self):
        self.count = 0
    
    def increment(self):
        self.count += 1
        return self.count

c = Counter()
print(c.increment(), c.increment(), c.increment())`,
        "options": [
            "0 1 2",
            "1 2 3",
            "1 1 1",
            "3 3 3"
        ],
        "correctAnswer": "1 2 3",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "Each call to increment() increases the count by 1 and returns the new value. First call returns 1, second returns 2, third returns 3."
    },
    {
        "questionId": 40,
        "title": "Class with Default Parameter",
        "type": "mcq-single",
        "description": "What will be printed by the code below?",
        "code": `class Book:
    def __init__(self, title, author="Unknown"):
        self.title = title
        self.author = author
    
    def info(self):
        return f'"{self.title}" by {self.author}'

b1 = Book("Python Basics")
b2 = Book("Java Guide", "John Doe")
print(b1.info())
print(b2.info())`,
        "options": [
            "\"Python Basics\" by Unknown\n\"Java Guide\" by John Doe",
            "\"Python Basics\" by \n\"Java Guide\" by John Doe",
            "Python Basics by Unknown\nJava Guide by John Doe",
            "\"Unknown\" by Python Basics\n\"John Doe\" by Java Guide"
        ],
        "correctAnswer": "\"Python Basics\" by Unknown\n\"Java Guide\" by John Doe",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "b1 uses default author='Unknown', b2 provides author='John Doe'. The info() method returns formatted strings with quotes around title."
    },
    {
        "questionId": 41,
        "title": "Multiple Objects with Same Class",
        "type": "mcq-single",
        "description": "What is the output of this code?",
        "code": `class Rectangle:
    def __init__(self, length, width):
        self.length = length
        self.width = width
    
    def area(self):
        return self.length * self.width

r1 = Rectangle(5, 3)
r2 = Rectangle(4, 4)
print(r1.area(), r2.area())`,
        "options": [
            "15 16",
            "8 8",
            "15 15",
            "16 15"
        ],
        "correctAnswer": "15 16",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "r1 has length=5, width=3 ‚Üí area=5√ó3=15. r2 has length=4, width=4 ‚Üí area=4√ó4=16. Each object maintains its own instance variables."
    },
    {
    "questionId": 42,
    "title": "Syntax Error Detection",
    "type": "mcq-multiple",
    "description": "Which of the following Python code snippets contain syntax errors? Select all that apply.",
    "code": "",
    "options": [
        "for i in range(5):\n    print(i)",
        "x = 10\ny = 20\nif x > y print('x is greater')",
        "def calculate(a, b):\n    return a + b\nresult = calculate(5, 3)",
        "numbers = [1, 2, 3, 4, 5]\nfor num in numbers\n    print(num * 2)",
        "class MyClass:\n    def __init__(self, value):\n        self.value = value\n    def display():\n        print(self.value)"
    ],
    "correctAnswer": [
        "x = 10\ny = 20\nif x > y print('x is greater')",
        "numbers = [1, 2, 3, 4, 5]\nfor num in numbers\n    print(num * 2)"
    ],
    "maxScore": 2,
    "hasExplanations": true,
    "explanation": "Syntax errors found in:\n1. 'if x > y print('x is greater')' - Missing colon after condition\n2. 'for num in numbers\n    print(num * 2)' - Missing colon after 'numbers'\n\nThe other options are syntactically correct:\n- Option 1: Simple for loop with colon and indentation ‚úì\n- Option 3: Function definition and call ‚úì\n- Option 4: Class definition with methods (display() missing self parameter is a runtime error, not syntax error) ‚úì"
},

    {
        "questionId": 43,
        "title": "Inheritance Behavior",
        "type": "mcq-single",
        "description": "Consider the following Python classes. Which statement is correct?",
        "code": `class Animal:
    def speak(self):
        return "Animal sound"

class Dog(Animal):
    def speak(self):
        return "Woof!"

class Cat(Animal):
    pass

d = Dog()
c = Cat()`,
        "options": [
            "d.speak() returns 'Animal sound' and c.speak() returns 'Animal sound'",
            "d.speak() returns 'Woof!' and c.speak() returns 'Animal sound'",
            "d.speak() returns 'Woof!' and c.speak() raises AttributeError",
            "Both d.speak() and c.speak() return 'Woof!'"
        ],
        "correctAnswer": "d.speak() returns 'Woof!' and c.speak() returns 'Animal sound'",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "Dog overrides the speak() method, so d.speak() returns 'Woof!'. Cat inherits the speak() method from Animal without overriding it, so c.speak() returns 'Animal sound'."
    },
    {
        "questionId": 44,
        "title": "Class vs Instance Variables",
        "type": "mcq-single",
        "description": "What will be the output of this code?",
        "code": `class Employee:
    company = "TechCorp"
    
    def __init__(self, name):
        self.name = name

e1 = Employee("Alice")
e2 = Employee("Bob")
Employee.company = "NewTech"
e1.company = "StartUp"

print(e1.company, e2.company, Employee.company)`,
        "options": [
            "StartUp NewTech NewTech",
            "StartUp TechCorp NewTech",
            "StartUp NewTech StartUp",
            "NewTech NewTech NewTech"
        ],
        "correctAnswer": "StartUp NewTech NewTech",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "'company' is a class variable. When we do e1.company = 'StartUp', it creates an instance variable for e1 that shadows the class variable. e2 still uses the class variable which was changed to 'NewTech'. Employee.company shows the class variable value 'NewTech'."
    },

    {
        "questionId": 45,
        "title": "Boolean Expression Equivalence",
        "type": "mcq-single",
        "description": "E1 and E2 are Boolean expressions. Consider the following expression:\nnot(E1 and E2) == (not E1 and not E2)\nWhat can you say about the value of the expression given above?",
        "code": "not(E1 and E2) == (not E1 and not E2)",
        "options": [
            "It is True if and only if E1 and E2 have same values",
            "It is False if and only if E1 and E2 have the same value",
            "It is always True",
            "It is always False"
        ],
        "correctAnswer": "It is always False",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "This is testing De Morgan's Law. The correct form is not(E1 and E2) == (not E1 OR not E2). The given expression (not E1 and not E2) is only True when both E1 and E2 are False, while not(E1 and E2) is True in three cases. Therefore, the equality is always False."
    },
    {
        "questionId": 46,
        "title": "String and Integer Operations",
        "type": "mcq-single",
        "description": "What will be the output of the code given above for the input: 1 1234?",
        "code": `a, b, c, d = input()
print((a + b + c) * int(d))`,
        "options": [
            "1 123123123123",
            "1 18", 
            "1 24",
            "1 492",
            "1 123412341234"
        ],
        "correctAnswer": "1 123123123123",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "input() reads '1 1234' as a string. a,b,c,d = '1',' ','1','2' (space counts as character). a+b+c = '1 1' (string concatenation). int(d)=2. '1 1' * 2 = '1 11 1' (string repetition). Actually, let's trace: '1 1234' ‚Üí a='1', b=' ', c='1', d='2'. a+b+c = '1 1'. int(d)=2. '1 1' * 2 = '1 11 1'. Wait, that's not matching options.\n\nActually, I need to reconsider: The input is '1 1234' with space. So characters: '1', ' ', '1', '2', '3', '4' but we only unpack 4 variables. So a='1', b=' ', c='1', d='2'. a+b+c='1 1'. int(d)=2. '1 1'*2='1 11 1'. Not in options.\n\nLet me check the options: '1 123123123123' suggests a+b+c='123' and d=4. That would mean input '1234' without space. But the input shown is '1 1234'. There might be a typo or the space is part of the input display.\n\nIf input is actually '1234': a='1', b='2', c='3', d='4'. a+b+c='123', int(d)=4, '123'*4='123123123123'. With print, it shows '123123123123'."
    },
    {
        "questionId": 47,
        "title": "Nested Loop Count Calculation",
        "type": "mcq-single",
        "description": "If n is a positive integer, then what will be the value of count at the end of execution of the code given below?",
        "code": `n = int(input())
count = 0
for x in range(1, n + 1):
    for y in range(x + 1, n + 1):
        count = count + 1`,
        "options": [
            "n¬≤",
            "n(n+1)",
            "n(n+1)/2", 
            "n(n-1)/2"
        ],
        "correctAnswer": "n(n-1)/2",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "The nested loops count pairs (x,y) where 1 ‚â§ x < y ‚â§ n. This is the number of combinations of 2 elements from n elements = C(n,2) = n(n-1)/2. For x=1, y runs n-1 times; x=2, y runs n-2 times; ... x=n-1, y runs 1 time. Sum = (n-1)+(n-2)+...+1 = n(n-1)/2."
    },
    {
        "questionId": 48,
        "title": "List Accumulation Pattern",
        "type": "mcq-single",
        "description": "What will be the output of the code snippet given below?",
        "code": `L = [0]
for i in range(1, 10):
    size = len(L)
    value = i + L[size-1]
    L.append(value)
print(L)`,
        "options": [
            "[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]",
            "[0, 1, 3, 6, 10, 15, 21, 28, 36, 45]",
            "[1, 3, 6, 10, 15, 21, 28, 36, 45]",
            "[0, 1, 3, 6, 10, 15, 21, 28, 36, 45, 55]"
        ],
        "correctAnswer": "[0, 1, 3, 6, 10, 15, 21, 28, 36, 45]",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "L starts as [0]. Each iteration: value = i + last element of L. Sequence: i=1: 1+0=1 ‚Üí [0,1]; i=2: 2+1=3 ‚Üí [0,1,3]; i=3: 3+3=6 ‚Üí [0,1,3,6]; ... This generates triangular numbers: 0, 1, 3, 6, 10, 15, 21, 28, 36, 45."
    },
    {
        "questionId": 49,
        "title": "Nested Sum and Factorial",
        "type": "mcq-single",
        "description": "If n is a positive integer, what is the output of the following code? Assume natural numbers start from 1.",
        "code": `a = n
for i in range(1, n):
    a = a + i
b = a
for j in range(1, a):
    b = b * j
print(b)`,
        "options": [
            "Sum of the factorial of the first n-1 natural numbers",
            "Factorial of the sum of the first n-1 natural numbers",
            "Sum of the factorial of the first n natural numbers", 
            "Factorial of the sum of the first n natural numbers"
        ],
        "correctAnswer": "Factorial of the sum of the first n natural numbers",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "First loop: a = n + (1+2+...+(n-1)) = sum of first n natural numbers = n(n+1)/2. Second loop: b = a * 1 * 2 * ... * (a-1) = a! = factorial of a. So b = (sum of first n natural numbers)!"
    },
    
    {
        "questionId": 50,
        "title": "Simple List Operation",
        "type": "mcq-single",
        "description": "What is the output of the following code?",
        "code": `numbers = [1, 2, 3, 4, 5]
result = numbers[1:4]
print(result)`,
        "options": [
            "[1, 2, 3]",
            "[2, 3, 4]", 
            "[2, 3, 4, 5]",
            "[1, 2, 3, 4]"
        ],
        "correctAnswer": "[2, 3, 4]",
        "maxScore": 2,
        "hasExplanations": true,
        "explanation": "List slicing [1:4] includes elements from index 1 up to, but not including, index 4. So elements at indices 1, 2, and 3: 2, 3, 4."
    }
    
        ];

        let currentQuestionIndex = 0;
        let userAnswers = {};
        let currentUser = {};


        async function initializeQuiz() {
            console.log('üöÄ Initializing quiz...');
            
            // Initialize with test user first (fallback)
            currentUser = { username: 'TestUser', email: 'test@example.com' };
            userAnswers = {};
            
            // Try to get user session (non-blocking)
            try {
                const response = await fetch('https://sanghamitra-learnworld.vercel.app/api/session-info', {
                    credentials: 'include',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.username && data.email) {
                        currentUser = { username: data.username, email: data.email };
                        console.log('‚úÖ User logged in:', currentUser);
                    }
                }
            } catch (error) {
                console.log('‚ÑπÔ∏è Using test user for demo');
            }
            
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            
            renderCurrentQuestion();
            updateProgress();
        }

        

        function renderCurrentQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('questionContainer');
            
            let questionHTML = `
                <div class="question-card">
                    <h4>Question ${currentQuestionIndex + 1}: ${question.title}</h4>
            `;

            // Add description if available
            if (question.description) {
                questionHTML += `<p class="mb-3">${question.description}</p>`;
            }

            // Add code block if available
            if (question.code) {
                questionHTML += `
                    <div class="code-block">
                        <pre>${question.code}</pre>
                    </div>
                `;
            }

            if (question.type === 'mcq-single') {
                questionHTML += `<div class="options-container mt-3">`;
                question.options.forEach((option, index) => {
                    const isSelected = userAnswers[question.questionId] === option;
                    questionHTML += `
                        <label class="option-label ${isSelected ? 'selected' : ''}">
                            <input type="radio" name="q${question.questionId}" value="${option}" 
                                   ${isSelected ? 'checked' : ''} style="display: none;">
                            ${option}
                        </label>
                    `;
                });
                questionHTML += `</div>`;
            } else if (question.type === 'mcq-multiple') {
                                
                    questionHTML += `<div class="options-container mt-3">`;
                    const currentAnswers = userAnswers[question.questionId] || [];
                    question.options.forEach((option, index) => {
                        const isSelected = Array.isArray(currentAnswers) && currentAnswers.includes(option);
                        // FIX: Convert \n to <br> for proper line breaks
                        const formattedOption = option.replace(/\n/g, '<br>');
                        
                        questionHTML += `
                            <label class="option-label ${isSelected ? 'selected' : ''}">
                                <input type="checkbox" name="q${question.questionId}" value="${option}" 
                                    ${isSelected ? 'checked' : ''} style="display: none;">
                                <div style="font-family: 'Courier New', monospace; white-space: pre-wrap; padding: 5px;">${formattedOption}</div>
                            </label>
                        `;
                    });
                    questionHTML += `</div>`;
                
            } else if (question.type === 'numerical') {
                const currentAnswer = userAnswers[question.questionId] || '';
                questionHTML += `
                    <div class="mt-3">
                        <input type="number" class="numerical-input" 
                               value="${currentAnswer}" 
                               placeholder="Enter your answer"
                               onchange="saveNumericalAnswer(${question.questionId}, this.value)">
                    </div>
                `;
            }

            questionHTML += `</div>`;

            container.innerHTML = questionHTML;

            // Use event delegation for option selection
            setTimeout(() => {
                const optionsContainer = container.querySelector('.options-container');
                if (optionsContainer) {
                    optionsContainer.addEventListener('click', function(e) {
                        const label = e.target.closest('.option-label');
                        if (!label) return;
                        
                        const input = label.querySelector('input');
                        if (!input) return;
                        
                        if (question.type === 'mcq-single') {
                            // Deselect all other options
                            optionsContainer.querySelectorAll('.option-label').forEach(l => {
                                l.classList.remove('selected');
                                const inp = l.querySelector('input');
                                if (inp && inp.type === 'radio') inp.checked = false;
                            });
                            
                            // Select clicked option
                            label.classList.add('selected');
                            input.checked = true;
                            userAnswers[question.questionId] = input.value;
                        } 
                        else if (question.type === 'mcq-multiple') {
                            // Toggle selection for multiple choice
                            const wasChecked = input.checked;
                            input.checked = !wasChecked;
                            
                            if (input.checked) {
                                label.classList.add('selected');
                            } else {
                                label.classList.remove('selected');
                            }
                            
                            // Update user answers array
                            if (!userAnswers[question.questionId]) {
                                userAnswers[question.questionId] = [];
                            }
                            
                            if (input.checked) {
                                if (!userAnswers[question.questionId].includes(input.value)) {
                                    userAnswers[question.questionId].push(input.value);
                                }
                            } else {
                                userAnswers[question.questionId] = userAnswers[question.questionId].filter(v => v !== input.value);
                            }
                        }
                        
                        updateProgress();
                    });
                }
            }, 10);
        }

        function saveNumericalAnswer(questionId, value) {
            userAnswers[questionId] = value ? parseInt(value) : '';
            updateProgress();
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderCurrentQuestion();
                updateProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderCurrentQuestion();
                updateProgress();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            // Show/hide appropriate buttons
            if (currentQuestionIndex === questions.length - 1) {
                // Last question: Hide Next, Show Submit button
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'inline-block';
            } else {
                // Not last question: Show Next, Hide Submit button
                nextBtn.style.display = 'inline-block';
                submitBtn.style.display = 'none';
            }
            
            
        }

        function calculateCurrentScore() {
            let totalScore = 0;
            
            questions.forEach(question => {
                const userAnswer = userAnswers[question.questionId];
                
                if (question.type === 'mcq-multiple') {
                    // Handle multiple-correct-answer questions
                    const userArr = Array.isArray(userAnswer) ? userAnswer : [];
                    const correctArr = Array.isArray(question.correctAnswer) ? question.correctAnswer : [];
                    
                    // Check if arrays contain exactly the same elements (order doesn't matter)
                    const userSorted = [...userArr].sort();
                    const correctSorted = [...correctArr].sort();
                    
                    if (JSON.stringify(userSorted) === JSON.stringify(correctSorted)) {
                        totalScore += question.maxScore;
                    }
                } else {
                    // For single-answer and numerical questions
                    if (userAnswer == question.correctAnswer) {
                        totalScore += question.maxScore;
                    }
                }
            });
            
            return totalScore;
        }

        async function submitQuiz() {
            const quizData = {
                username: currentUser.username,
                email: currentUser.email,
                topic: "Python basics",
                score: calculateCurrentScore(),
                maxScore: questions.reduce((sum, q) => sum + q.maxScore, 0),
                percentage: Math.round((calculateCurrentScore() / questions.reduce((sum, q) => sum + q.maxScore, 0)) * 100),
                timestamp: new Date(),
                questions: questions.map(question => {
                    const userAnswer = userAnswers[question.questionId];
                    let score = 0;
                    
                    if (question.type === 'mcq-multiple') {
                        // Handle multiple-correct-answer questions
                        const userArr = Array.isArray(userAnswer) ? userAnswer : [];
                        const correctArr = Array.isArray(question.correctAnswer) ? question.correctAnswer : [];
                        
                        const userSorted = [...userArr].sort();
                        const correctSorted = [...correctArr].sort();
                        
                        if (JSON.stringify(userSorted) === JSON.stringify(correctSorted)) {
                            score = question.maxScore;
                        }
                    } else {
                        // For single-answer and numerical questions
                        if (userAnswer == question.correctAnswer) {
                            score = question.maxScore;
                        }
                    }
                    
                    return {
                        questionId: question.questionId,
                        title: question.title,
                        type: question.type,
                        userAnswer: userAnswer || (question.type === 'mcq-multiple' ? [] : ''),
                        correctAnswer: question.correctAnswer,
                        options: question.options || [],
                        score: score,
                        maxScore: question.maxScore,
                        hasExplanations: question.hasExplanations,
                        explanation: question.explanation
                    };
                })
            };

            // Save to backend api/algorithm-submissions
            try {
                const response = await fetch('https://sanghamitra-learnworld.vercel.app/api/algorithm-submissions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(quizData)
                });

                if (response.ok) {
                    console.log('‚úÖ Quiz results saved successfully');
                } else {
                    console.log('‚ö†Ô∏è Failed to save results, but continuing...');
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Error saving results, but continuing...');
            }

            showResults(quizData);
        }

        function showResults(quizData) {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';
            
            document.getElementById('finalScore').textContent = `${quizData.score}/${quizData.maxScore}`;
            document.getElementById('finalPercentage').textContent = `${quizData.percentage}%`;
            
            const detailedResults = document.getElementById('detailedResults');
            let resultsHTML = `<h4>Detailed Results:</h4>`;
            
            quizData.questions.forEach((question, index) => {
                const isCorrect = question.score > 0;
                const userAnswer = Array.isArray(question.userAnswer) 
                    ? question.userAnswer.join(', ') 
                    : question.userAnswer;
                const correctAnswer = Array.isArray(question.correctAnswer) 
                    ? question.correctAnswer.join(', ') 
                    : question.correctAnswer;
                
                resultsHTML += `
                    <div class="question-card ${isCorrect ? 'border-success' : 'border-danger'}">
                        <h6>Q${index + 1}: ${question.title}</h6>
                        <p><strong>Your Answer:</strong> ${userAnswer || 'No answer'}</p>
                        <p><strong>Correct Answer:</strong> ${correctAnswer}</p>
                        <p><strong>Status:</strong> ${isCorrect ? '‚úÖ Correct' : '‚ùå Incorrect'}</p>
                        ${question.hasExplanations ? `
                            <div class="explanation-section">
                                <strong>Explanation:</strong> ${question.explanation}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            detailedResults.innerHTML = resultsHTML;
        }

        function restartQuiz() {
            currentQuestionIndex = 0;
            userAnswers = {};
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            // Reset button visibility
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            nextBtn.style.display = 'inline-block';
            submitBtn.style.display = 'none';
            renderCurrentQuestion();
            updateProgress();
        }
        function goToHome() {
            window.location.href = './iitm-pdsa.html';
        }

        // REPLACE the Monaco initialization with this:
        document.addEventListener('DOMContentLoaded', initializeQuiz);
    </script>
</body>
</html>
