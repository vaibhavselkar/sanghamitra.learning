<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Quiz Test Suite - Enhanced Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
            top: -50%;
            left: -50%;
        }

        @keyframes shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            position: relative;
            z-index: 1;
        }

        .main-content {
            padding: 40px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stat-card.success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .stat-card.danger { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); }
        .stat-card.warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }

        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .stat-card .value {
            font-size: 48px;
            font-weight: bold;
            position: relative;
            z-index: 1;
            animation: countUp 0.5s ease-out;
        }

        @keyframes countUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .stat-card .icon {
            font-size: 60px;
            position: absolute;
            bottom: -10px;
            right: 10px;
            opacity: 0.2;
            z-index: 0;
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 40px;
            background: #ecf0f1;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db 0%, #2ecc71 100%);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-card h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .pie-chart {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            gap: 10px;
        }

        .bar {
            flex: 1;
            background: linear-gradient(to top, #3498db, #2ecc71);
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: all 0.5s;
            min-height: 0;
            animation: barGrow 1s ease-out;
        }

        @keyframes barGrow {
            from { transform: scaleY(0); }
            to { transform: scaleY(1); }
        }

        .bar:hover {
            opacity: 0.8;
            transform: scaleY(1.05);
        }

        .bar-label {
            text-align: center;
            margin-top: 10px;
            font-size: 12px;
            color: #7f8c8d;
        }

        .results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .test-category {
            margin-bottom: 30px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .test-category h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            position: relative;
            overflow: hidden;
        }

        .test-category h3::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.1), transparent);
            transition: width 0.3s;
        }

        .test-category h3:hover::before {
            width: 100%;
        }

        .test-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #bdc3c7;
            transition: all 0.3s;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .test-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .test-item.passed {
            border-left-color: #2ecc71;
            background: linear-gradient(90deg, rgba(46, 204, 113, 0.05), white);
        }

        .test-item.failed {
            border-left-color: #e74c3c;
            background: linear-gradient(90deg, rgba(231, 76, 60, 0.05), white);
        }

        .test-item.warning {
            border-left-color: #f39c12;
            background: linear-gradient(90deg, rgba(243, 156, 18, 0.05), white);
        }

        .test-item.running {
            border-left-color: #3498db;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.4);
            }
            50% { 
                opacity: 0.8; 
                box-shadow: 0 0 0 10px rgba(52, 152, 219, 0);
            }
        }

        .test-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-status {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 600;
        }

        .test-status.passed { color: #2ecc71; }
        .test-status.failed { color: #e74c3c; }
        .test-status.warning { color: #f39c12; }

        .test-details {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }

        .assertion {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .assertion:hover {
            transform: translateX(5px);
        }

        .assertion.passed {
            background: rgba(46, 204, 113, 0.1);
        }

        .assertion.passed::before {
            content: "‚úì ";
            color: #2ecc71;
            font-weight: bold;
            font-size: 16px;
        }

        .assertion.failed {
            background: rgba(231, 76, 60, 0.1);
        }

        .assertion.failed::before {
            content: "‚úó ";
            color: #e74c3c;
            font-weight: bold;
            font-size: 16px;
        }

        .assertion.warning {
            background: rgba(243, 156, 18, 0.1);
        }

        .assertion.warning::before {
            content: "‚ö† ";
            color: #f39c12;
            font-weight: bold;
            font-size: 16px;
        }

        .file-upload {
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa, #ecf0f1);
            border-radius: 10px;
            border: 2px dashed #bdc3c7;
            text-align: center;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: #3498db;
            background: linear-gradient(135deg, #ecf0f1, #e0e6e8);
        }

        .file-upload.dragover {
            border-color: #2ecc71;
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(46, 204, 113, 0.05));
            transform: scale(1.02);
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input {
            opacity: 0;
            position: absolute;
            z-index: -1;
        }

        .file-input-label {
            display: inline-block;
            padding: 15px 30px;
            background: #3498db;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .uploaded-files {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .file-badge {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            color: #2c3e50;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease-out;
        }

        .summary {
            background: white;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #3498db, #2ecc71, #f39c12, #e74c3c);
        }

        .summary.all-passed { 
            border: 3px solid #2ecc71;
            box-shadow: 0 0 30px rgba(46, 204, 113, 0.3);
        }

        .summary.has-failures { 
            border: 3px solid #e74c3c;
            box-shadow: 0 0 30px rgba(231, 76, 60, 0.3);
        }

        .summary.has-warnings { 
            border: 3px solid #f39c12;
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.3);
        }

        .summary h2 {
            margin-bottom: 20px;
            font-size: 32px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .summary-stat {
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .category-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .category-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .category-card h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .category-progress {
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .category-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s;
        }

        .sparkline {
            display: flex;
            align-items: flex-end;
            height: 40px;
            gap: 2px;
            margin-top: 10px;
        }

        .sparkline-bar {
            flex: 1;
            background: #3498db;
            border-radius: 2px;
            transition: all 0.3s;
        }

        .sparkline-bar:hover {
            background: #2980b9;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #7f8c8d;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .timeline {
            position: relative;
            padding-left: 30px;
            margin-top: 20px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #3498db, #2ecc71);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 5px;
            width: 12px;
            height: 12px;
            background: white;
            border: 2px solid #3498db;
            border-radius: 50%;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #2c3e50;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Visual Quiz Test Suite</h1>
            <p>Comprehensive automated testing with real-time visual analytics</p>
        </div>

        <div class="main-content">
            <div class="file-upload" id="fileUploadArea">
                <div class="empty-state-icon">üìÅ</div>
                <h3>Upload Quiz Files to Test</h3>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" class="file-input" multiple 
                           accept=".html,.htm,.js" onchange="handleFileUpload(event)">
                    <label for="fileInput" class="file-input-label">
                        Choose Files
                    </label>
                </div>
                <p style="font-size: 14px; color: #666; margin-top: 15px;">
                    Drop files here or click to browse ‚Ä¢ Supports HTML and JS files
                </p>
                <div class="uploaded-files" id="uploadedFilesList"></div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" id="runAllBtn" onclick="runAllTests()">
                    <span>Run All Tests</span>
                </button>
                <button class="btn btn-primary" onclick="runAnswerFormatTests()">Test Answer Formats</button>
                <button class="btn btn-primary" onclick="runValidationTests()">Test Validation</button>
                <button class="btn btn-primary" onclick="runMissingPiecesTests()">Find Missing Pieces</button>
                <button class="btn btn-primary" onclick="clearResults()">Clear Results</button>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="icon">üìä</div>
                    <h3>Total Tests</h3>
                    <div class="value" id="totalTests">0</div>
                </div>
                <div class="stat-card success">
                    <div class="icon">‚úì</div>
                    <h3>Passed</h3>
                    <div class="value" id="passedTests">0</div>
                </div>
                <div class="stat-card danger">
                    <div class="icon">‚úó</div>
                    <h3>Failed</h3>
                    <div class="value" id="failedTests">0</div>
                </div>
                <div class="stat-card warning">
                    <div class="icon">‚ö†</div>
                    <h3>Warnings</h3>
                    <div class="value" id="warningTests">0</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
            </div>

            <div class="chart-container" id="chartContainer" style="display: none;">
                <div class="chart-card">
                    <h3>Test Results Distribution</h3>
                    <canvas id="pieChart" width="200" height="200"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Category Performance</h3>
                    <div id="barChart" class="bar-chart"></div>
                </div>
            </div>

            <div class="category-summary" id="categorySummary"></div>

            <div class="results" id="results">
                <div class="empty-state">
                    <div class="empty-state-icon">üéØ</div>
                    <h3>Ready to Begin Testing</h3>
                    <p style="margin-top: 20px;">Upload quiz files to automatically analyze:</p>
                    <ul style="text-align: left; display: inline-block; margin-top: 20px; line-height: 1.8;">
                        <li>‚úì Answer input formats (interval, numeric, coordinate, equation)</li>
                        <li>‚úì Answer normalization and validation</li>
                        <li>‚úì Infinity symbol handling (‚àû, inf, infinity)</li>
                        <li>‚úì Calculator functionality</li>
                        <li>‚úì Anti-cheating mechanisms</li>
                        <li>‚úì Missing functionality detection</li>
                        <li>‚úì UI components and navigation</li>
                        <li>‚úì Error handling and edge cases</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let uploadedFiles = [];
        let tests = [];
        let currentTest = 0;
        let passed = 0;
        let failed = 0;
        let warnings = 0;
        let running = false;
        let categoryStats = {};

        // Drag and drop functionality
        const fileUploadArea = document.getElementById('fileUploadArea');
        
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('dragover');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        function handleFileUpload(event) {
            const files = event.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            uploadedFiles = [];
            const fileArray = Array.from(files);
            const filesList = document.getElementById('uploadedFilesList');
            filesList.innerHTML = '';
            
            fileArray.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedFiles.push({
                        name: file.name,
                        content: e.target.result,
                        type: file.type
                    });
                    
                    // Add file badge
                    const badge = document.createElement('div');
                    badge.className = 'file-badge';
                    badge.textContent = `üìÑ ${file.name}`;
                    filesList.appendChild(badge);
                    
                    if (uploadedFiles.length === fileArray.length) {
                        document.getElementById('runAllBtn').disabled = false;
                        showNotification(`${uploadedFiles.length} file(s) loaded successfully!`, 'success');
                    }
                };
                reader.readAsText(file);
            });
        }

        function showNotification(message, type = 'info') {
            // Create a simple notification (you could enhance this)
            alert(message);
        }

        async function runAllTests() {
            if (uploadedFiles.length === 0) {
                showNotification('Please upload quiz files first!', 'warning');
                return;
            }

            running = true;
            currentTest = 0;
            passed = 0;
            failed = 0;
            warnings = 0;
            categoryStats = {};

            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';

            tests = generateComprehensiveTests();
            document.getElementById('totalTests').textContent = tests.length;

            // Show charts
            document.getElementById('chartContainer').style.display = 'grid';

            for (let i = 0; i < tests.length; i++) {
                if (!running) break;

                currentTest = i;
                const test = tests[i];
                
                updateProgress();
                renderTest(test, 'running');
                
                await sleep(50); // Faster for better UX
                
                const result = test.run();
                
                if (result.passed) {
                    passed++;
                } else if (result.warning) {
                    warnings++;
                } else {
                    failed++;
                }

                // Update category stats
                if (!categoryStats[test.category]) {
                    categoryStats[test.category] = { passed: 0, failed: 0, warnings: 0, total: 0 };
                }
                categoryStats[test.category].total++;
                if (result.passed) categoryStats[test.category].passed++;
                else if (result.warning) categoryStats[test.category].warnings++;
                else categoryStats[test.category].failed++;
                
                renderTest(test, result.warning ? 'warning' : (result.passed ? 'passed' : 'failed'), result);
                updateStats();
                updateCharts();
                updateCategorySummary();
            }

            running = false;
            showSummary();
        }

        function generateComprehensiveTests() {
            const allTests = [];

            uploadedFiles.forEach(file => {
                const content = file.content;
                const fileName = file.name;

                // Category 1: Answer Format Tests
                allTests.push({
                    category: 'Answer Format',
                    name: `${fileName}: Interval Notation Support`,
                    run: () => testIntervalNotation(content)
                });

                allTests.push({
                    category: 'Answer Format',
                    name: `${fileName}: Infinity Symbol Handling`,
                    run: () => testInfinityHandling(content)
                });

                allTests.push({
                    category: 'Answer Format',
                    name: `${fileName}: Numeric Input Validation`,
                    run: () => testNumericValidation(content)
                });

                allTests.push({
                    category: 'Answer Format',
                    name: `${fileName}: Coordinate Input Format`,
                    run: () => testCoordinateFormat(content)
                });

                allTests.push({
                    category: 'Answer Format',
                    name: `${fileName}: Equation Input Format`,
                    run: () => testEquationFormat(content)
                });

                // Category 2: Normalization Tests
                allTests.push({
                    category: 'Normalization',
                    name: `${fileName}: Answer Normalizer Present`,
                    run: () => testAnswerNormalizer(content)
                });

                allTests.push({
                    category: 'Normalization',
                    name: `${fileName}: Space Removal Logic`,
                    run: () => testSpaceRemoval(content)
                });

                allTests.push({
                    category: 'Normalization',
                    name: `${fileName}: Case Insensitivity`,
                    run: () => testCaseInsensitivity(content)
                });

                // Category 3: Calculator Tests
                allTests.push({
                    category: 'Calculator',
                    name: `${fileName}: Calculator Present`,
                    run: () => testCalculatorPresence(content)
                });

                allTests.push({
                    category: 'Calculator',
                    name: `${fileName}: Scientific Functions`,
                    run: () => testScientificFunctions(content)
                });

                allTests.push({
                    category: 'Calculator',
                    name: `${fileName}: Draggable Calculator`,
                    run: () => testDraggableCalculator(content)
                });

                // Category 4: UI Components
                allTests.push({
                    category: 'UI Components',
                    name: `${fileName}: Progress Bar`,
                    run: () => testProgressBar(content)
                });

                allTests.push({
                    category: 'UI Components',
                    name: `${fileName}: Question Navigation`,
                    run: () => testQuestionNavigation(content)
                });

                allTests.push({
                    category: 'UI Components',
                    name: `${fileName}: Answer Status Indicator`,
                    run: () => testAnswerStatus(content)
                });

                // Category 5: Anti-Cheating
                allTests.push({
                    category: 'Anti-Cheating',
                    name: `${fileName}: Right-Click Disabled`,
                    run: () => testRightClickDisabled(content)
                });

                allTests.push({
                    category: 'Anti-Cheating',
                    name: `${fileName}: Copy-Paste Prevention`,
                    run: () => testCopyPastePrevention(content)
                });

                allTests.push({
                    category: 'Anti-Cheating',
                    name: `${fileName}: DevTools Detection`,
                    run: () => testDevToolsDetection(content)
                });

                // Category 6: Missing Pieces Detection
                allTests.push({
                    category: 'Missing Pieces',
                    name: `${fileName}: Question Navigator (Midterm)`,
                    run: () => testQuestionNavigator(content, fileName)
                });

                allTests.push({
                    category: 'Missing Pieces',
                    name: `${fileName}: Answer Preview Box`,
                    run: () => testAnswerPreview(content)
                });

                allTests.push({
                    category: 'Missing Pieces',
                    name: `${fileName}: Format Help/Info Bubble`,
                    run: () => testFormatHelp(content)
                });

                allTests.push({
                    category: 'Missing Pieces',
                    name: `${fileName}: MathJax LaTeX Support`,
                    run: () => testMathJaxSupport(content)
                });

                // Category 7: Error Handling
                allTests.push({
                    category: 'Error Handling',
                    name: `${fileName}: Empty Answer Handling`,
                    run: () => testEmptyAnswerHandling(content)
                });

                allTests.push({
                    category: 'Error Handling',
                    name: `${fileName}: Invalid Format Warning`,
                    run: () => testInvalidFormatWarning(content)
                });

                allTests.push({
                    category: 'Error Handling',
                    name: `${fileName}: Network Error Handling`,
                    run: () => testNetworkErrorHandling(content)
                });

                // Category 8: Functionality Tests
                allTests.push({
                    category: 'Functionality',
                    name: `${fileName}: Submit Quiz Function`,
                    run: () => testSubmitFunction(content)
                });

                allTests.push({
                    category: 'Functionality',
                    name: `${fileName}: Results Display`,
                    run: () => testResultsDisplay(content)
                });

                allTests.push({
                    category: 'Functionality',
                    name: `${fileName}: Question Timing`,
                    run: () => testQuestionTiming(content)
                });
            });

            return allTests;
        }

        // ============================================
        // TEST IMPLEMENTATIONS (same as original)
        // ============================================

        function testIntervalNotation(content) {
            const assertions = [];
            
            const hasIntervalInput = /interval_input|normalizeInterval/i.test(content);
            assertions.push({
                passed: hasIntervalInput,
                message: hasIntervalInput ? '‚úì Interval notation support found' : '‚úó No interval notation support'
            });

            const hasInfinityHandling = /infinity|‚àû|inf/i.test(content);
            assertions.push({
                passed: hasInfinityHandling,
                message: hasInfinityHandling ? '‚úì Infinity handling in intervals' : '‚úó No infinity handling'
            });

            const hasParenthesesHandling = /\[|\]|\(|\)/g.test(content);
            assertions.push({
                passed: hasParenthesesHandling,
                message: hasParenthesesHandling ? '‚úì Bracket/parenthesis handling' : '‚úó No bracket handling'
            });

            return { 
                passed: assertions.every(a => a.passed),
                assertions 
            };
        }

        function testInfinityHandling(content) {
            const assertions = [];
            
            const patterns = [
                { name: 'infinity keyword', regex: /infinity/i },
                { name: '‚àû symbol', regex: /‚àû/ },
                { name: 'inf abbreviation', regex: /\binf\b/i },
                { name: 'Infinity normalization', regex: /\.replace\([^)]*infinity[^)]*\)/i }
            ];

            patterns.forEach(pattern => {
                const found = pattern.regex.test(content);
                assertions.push({
                    passed: found,
                    message: found ? `‚úì ${pattern.name} supported` : `‚ö† ${pattern.name} not found`
                });
            });

            const anyFound = assertions.some(a => a.passed);
            return { 
                passed: anyFound,
                warning: !assertions.every(a => a.passed),
                assertions 
            };
        }

        function testNumericValidation(content) {
            const assertions = [];
            
            const hasNumericInput = /numeric_input|handleNumericInput/i.test(content);
            assertions.push({
                passed: hasNumericInput,
                message: hasNumericInput ? '‚úì Numeric input handling' : '‚úó No numeric input handling'
            });

            const hasValidation = /validateAnswer|normalizeNumeric|parseFloat/i.test(content);
            assertions.push({
                passed: hasValidation,
                message: hasValidation ? '‚úì Numeric validation logic' : '‚ö† Limited validation'
            });

            const hasTolerance = /tolerance|0\.01|Math\.abs/i.test(content);
            assertions.push({
                passed: hasTolerance,
                message: hasTolerance ? '‚úì Tolerance checking' : '‚ö† No tolerance checking'
            });

            return { 
                passed: hasNumericInput,
                warning: !hasTolerance,
                assertions 
            };
        }

        function testCoordinateFormat(content) {
            const assertions = [];
            
            const hasCoordinateInput = /coordinate_input|normalizeCoordinate/i.test(content);
            assertions.push({
                passed: hasCoordinateInput,
                message: hasCoordinateInput ? '‚úì Coordinate input support' : '‚ö† No coordinate input support'
            });

            const hasParenthesesHandling = /\(.*,.*\)|replace\([^)]*\([^)]*\)/i.test(content);
            assertions.push({
                passed: hasParenthesesHandling,
                message: hasParenthesesHandling ? '‚úì Parentheses handling' : '‚ö† No parentheses handling'
            });

            return { 
                passed: true,
                warning: !hasCoordinateInput,
                assertions 
            };
        }

        function testEquationFormat(content) {
            const assertions = [];
            
            const hasEquationInput = /equation_input|normalizeEquation/i.test(content);
            assertions.push({
                passed: hasEquationInput,
                message: hasEquationInput ? '‚úì Equation input support' : '‚ö† No equation input support'
            });

            const hasEqualsCheck = /includes\(['"]=['"]\)|\.includes\("="\)/i.test(content);
            assertions.push({
                passed: hasEqualsCheck,
                message: hasEqualsCheck ? '‚úì Equals sign validation' : '‚ö† No equals validation'
            });

            return { 
                passed: true,
                warning: !hasEquationInput,
                assertions 
            };
        }

        function testAnswerNormalizer(content) {
            const assertions = [];
            
            const hasNormalizer = /answerNormalizer|AnswerNormalizer|normalizeAnswer/i.test(content);
            assertions.push({
                passed: hasNormalizer,
                message: hasNormalizer ? '‚úì Answer normalizer present' : '‚úó No answer normalizer found'
            });

            const methods = ['normalizeInterval', 'normalizeNumeric', 'normalizeCoordinate', 'normalizeEquation'];
            methods.forEach(method => {
                const found = content.includes(method);
                assertions.push({
                    passed: found,
                    message: found ? `‚úì ${method} implemented` : `‚ö† ${method} missing`
                });
            });

            return { 
                passed: hasNormalizer,
                warning: !methods.every(m => content.includes(m)),
                assertions 
            };
        }

        function testSpaceRemoval(content) {
            const assertions = [];
            
            const hasSpaceRemoval = /\.replace\([^)]*\\s\+[^)]*['"]['"]['"]\)/g.test(content);
            assertions.push({
                passed: hasSpaceRemoval,
                message: hasSpaceRemoval ? '‚úì Space removal logic found' : '‚ö† No space removal'
            });

            const hasTrim = /\.trim\(\)/g.test(content);
            assertions.push({
                passed: hasTrim,
                message: hasTrim ? '‚úì Trim function used' : '‚ö† No trim function'
            });

            return { 
                passed: hasSpaceRemoval || hasTrim,
                warning: !hasSpaceRemoval,
                assertions 
            };
        }

        function testCaseInsensitivity(content) {
            const assertions = [];
            
            const hasLowerCase = /\.toLowerCase\(\)/g.test(content);
            assertions.push({
                passed: hasLowerCase,
                message: hasLowerCase ? '‚úì Case normalization (toLowerCase)' : '‚úó No case normalization'
            });

            const hasUpperCase = /\.toUpperCase\(\)/g.test(content);
            assertions.push({
                passed: hasUpperCase,
                message: hasUpperCase ? '‚úì Also uses toUpperCase' : '‚Ñπ Only toLowerCase used'
            });

            return { 
                passed: hasLowerCase,
                assertions 
            };
        }

        function testCalculatorPresence(content) {
            const assertions = [];
            
            const hasCalculator = /calculator|calcDisplay/i.test(content);
            assertions.push({
                passed: hasCalculator,
                message: hasCalculator ? '‚úì Calculator implementation found' : '‚úó No calculator found'
            });

            const hasToggleFunction = /toggleCalculator/i.test(content);
            assertions.push({
                passed: hasToggleFunction,
                message: hasToggleFunction ? '‚úì Toggle function present' : '‚ö† No toggle function'
            });

            return { 
                passed: hasCalculator,
                assertions 
            };
        }

        function testScientificFunctions(content) {
            const assertions = [];
            
            const scientificFunctions = ['sin', 'cos', 'tan', 'log', 'ln', 'sqrt'];
            scientificFunctions.forEach(func => {
                const found = new RegExp(`\\b${func}\\b`, 'i').test(content);
                assertions.push({
                    passed: found,
                    message: found ? `‚úì ${func} function` : `‚ö† ${func} missing`
                });
            });

            const anyFound = assertions.filter(a => a.passed).length >= 3;
            return { 
                passed: anyFound,
                warning: !assertions.every(a => a.passed),
                assertions 
            };
        }

        function testDraggableCalculator(content) {
            const assertions = [];
            
            const hasDrag = /drag|mousedown|mousemove|mouseup/i.test(content);
            assertions.push({
                passed: hasDrag,
                message: hasDrag ? '‚úì Draggable functionality' : '‚ö† Not draggable'
            });

            const hasPosition = /style\.left|style\.top/i.test(content);
            assertions.push({
                passed: hasPosition,
                message: hasPosition ? '‚úì Position handling' : '‚ö† No position handling'
            });

            return { 
                passed: true,
                warning: !hasDrag,
                assertions 
            };
        }

        function testProgressBar(content) {
            const assertions = [];
            
            const hasProgressBar = /progress-bar|progressFill/i.test(content);
            assertions.push({
                passed: hasProgressBar,
                message: hasProgressBar ? '‚úì Progress bar present' : '‚úó No progress bar'
            });

            const hasUpdate = /updateProgress|progress.*width/i.test(content);
            assertions.push({
                passed: hasUpdate,
                message: hasUpdate ? '‚úì Progress update logic' : '‚ö† No update logic'
            });

            return { 
                passed: hasProgressBar,
                assertions 
            };
        }

        function testQuestionNavigation(content) {
            const assertions = [];
            
            const hasNavigation = /nextQuestion|previousQuestion|btn-nav/i.test(content);
            assertions.push({
                passed: hasNavigation,
                message: hasNavigation ? '‚úì Navigation functions present' : '‚úó No navigation'
            });

            const hasPrevNext = /prevBtn.*nextBtn|previous.*next/i.test(content);
            assertions.push({
                passed: hasPrevNext,
                message: hasPrevNext ? '‚úì Prev/Next buttons' : '‚ö† Limited navigation'
            });

            return { 
                passed: hasNavigation,
                assertions 
            };
        }

        function testAnswerStatus(content) {
            const assertions = [];
            
            const hasStatus = /answeredStatus|status-answered|status-unanswered/i.test(content);
            assertions.push({
                passed: hasStatus,
                message: hasStatus ? '‚úì Answer status indicator' : '‚ö† No status indicator'
            });

            const hasUpdate = /updateAnswerStatus/i.test(content);
            assertions.push({
                passed: hasUpdate,
                message: hasUpdate ? '‚úì Status update function' : '‚ö† No update function'
            });

            return { 
                passed: true,
                warning: !hasStatus,
                assertions 
            };
        }

        function testRightClickDisabled(content) {
            const assertions = [];
            
            const hasDisable = /contextmenu.*preventDefault|contextmenu.*false/i.test(content);
            assertions.push({
                passed: hasDisable,
                message: hasDisable ? '‚úì Right-click disabled' : '‚ö† Right-click not disabled'
            });

            return { 
                passed: true,
                warning: !hasDisable,
                assertions 
            };
        }

        function testCopyPastePrevention(content) {
            const assertions = [];
            
            const hasCopyPaste = /copy|paste|Ctrl\+C|Ctrl\+V/i.test(content);
            assertions.push({
                passed: hasCopyPaste,
                message: hasCopyPaste ? '‚úì Copy/paste prevention' : '‚ö† No copy/paste prevention'
            });

            const hasSelection = /selectstart|user-select.*none/i.test(content);
            assertions.push({
                passed: hasSelection,
                message: hasSelection ? '‚úì Selection disabled' : '‚ö† Selection not disabled'
            });

            return { 
                passed: true,
                warning: !hasCopyPaste,
                assertions 
            };
        }

        function testDevToolsDetection(content) {
            const assertions = [];
            
            const hasDetection = /devtools|F12|outerHeight.*innerHeight/i.test(content);
            assertions.push({
                passed: hasDetection,
                message: hasDetection ? '‚úì DevTools detection' : '‚ö† No DevTools detection'
            });

            return { 
                passed: true,
                warning: !hasDetection,
                assertions 
            };
        }

        function testQuestionNavigator(content, fileName) {
            const assertions = [];
            
            const isMidterm = /midterm|quiz1/i.test(fileName);
            const hasNavigator = /question-navigator|questionGrid|question-grid/i.test(content);
            
            if (isMidterm) {
                assertions.push({
                    passed: hasNavigator,
                    message: hasNavigator ? '‚úì Question navigator present (Midterm feature)' : '‚úó Question navigator MISSING (required for Midterm)'
                });
            } else {
                assertions.push({
                    passed: true,
                    message: hasNavigator ? '‚Ñπ Question navigator present (bonus feature)' : '‚Ñπ Question navigator not needed for regular quiz'
                });
            }

            if (hasNavigator) {
                const hasClickable = /jumpToQuestion|onclick.*question/i.test(content);
                assertions.push({
                    passed: hasClickable,
                    message: hasClickable ? '‚úì Clickable navigation' : '‚ö† Navigator may not be clickable'
                });
            }

            return { 
                passed: isMidterm ? hasNavigator : true,
                warning: isMidterm && !hasNavigator,
                assertions 
            };
        }

        function testAnswerPreview(content) {
            const assertions = [];
            
            const hasPreview = /answer-preview|previewFormatted|preview-value/i.test(content);
            assertions.push({
                passed: hasPreview,
                message: hasPreview ? '‚úì Answer preview box present' : '‚Ñπ No answer preview (optional feature)'
            });

            if (hasPreview) {
                const hasMathJax = /MathJax|typesetPromise/i.test(content);
                assertions.push({
                    passed: hasMathJax,
                    message: hasMathJax ? '‚úì MathJax rendering in preview' : '‚ö† No MathJax in preview'
                });
            }

            return { 
                passed: true,
                warning: false,
                assertions 
            };
        }

        function testFormatHelp(content) {
            const assertions = [];
            
            const hasInfoBubble = /info-bubble|help-button|format.*help/i.test(content);
            assertions.push({
                passed: hasInfoBubble,
                message: hasInfoBubble ? '‚úì Format help/info bubble' : '‚Ñπ No format help bubble (optional)'
            });

            const hasPlaceholder = /placeholder.*interval|placeholder.*coordinate/i.test(content);
            assertions.push({
                passed: hasPlaceholder,
                message: hasPlaceholder ? '‚úì Helpful placeholders' : '‚ö† No helpful placeholders'
            });

            return { 
                passed: true,
                warning: !hasPlaceholder,
                assertions 
            };
        }

        function testMathJaxSupport(content) {
            const assertions = [];
            
            const hasMathJax = /MathJax|mathjax|tex-chtml/i.test(content);
            assertions.push({
                passed: hasMathJax,
                message: hasMathJax ? '‚úì MathJax library included' : '‚ö† No MathJax support'
            });

            if (hasMathJax) {
                const hasTypeset = /typesetPromise|typeset/i.test(content);
                assertions.push({
                    passed: hasTypeset,
                    message: hasTypeset ? '‚úì MathJax typesetting' : '‚ö† MathJax not used'
                });
            }

            return { 
                passed: true,
                warning: !hasMathJax,
                assertions 
            };
        }

        function testEmptyAnswerHandling(content) {
            const assertions = [];
            
            const hasEmptyCheck = /!answer|answer.*===.*['"]['"]|\.trim\(\)/i.test(content);
            assertions.push({
                passed: hasEmptyCheck,
                message: hasEmptyCheck ? '‚úì Empty answer checking' : '‚ö† No empty answer check'
            });

            const hasDelete = /delete.*userAnswers/i.test(content);
            assertions.push({
                passed: hasDelete,
                message: hasDelete ? '‚úì Empty answers removed' : '‚ö† Empty answers not removed'
            });

            return { 
                passed: hasEmptyCheck,
                assertions 
            };
        }

        function testInvalidFormatWarning(content) {
            const assertions = [];
            
            const hasWarning = /warning|invalid|format.*error/i.test(content);
            assertions.push({
                passed: hasWarning,
                message: hasWarning ? '‚úì Warning/error messages' : '‚ö† No format warnings'
            });

            const hasValidation = /validateAnswer|isValidFormat/i.test(content);
            assertions.push({
                passed: hasValidation,
                message: hasValidation ? '‚úì Validation function' : '‚ö† No validation function'
            });

            return { 
                passed: true,
                warning: !hasValidation,
                assertions 
            };
        }

        function testNetworkErrorHandling(content) {
            const assertions = [];
            
            const hasTryCatch = /try\s*{[\s\S]*catch/i.test(content);
            assertions.push({
                passed: hasTryCatch,
                message: hasTryCatch ? '‚úì Try-catch error handling' : '‚ö† No try-catch blocks'
            });

            const hasErrorAlert = /catch.*alert|error.*message/i.test(content);
            assertions.push({
                passed: hasErrorAlert,
                message: hasErrorAlert ? '‚úì Error messaging' : '‚ö† No error messages'
            });

            return { 
                passed: hasTryCatch,
                assertions 
            };
        }

        function testSubmitFunction(content) {
            const assertions = [];
            
            const hasSubmit = /submitQuiz|submit.*function/i.test(content);
            assertions.push({
                passed: hasSubmit,
                message: hasSubmit ? '‚úì Submit function present' : '‚úó No submit function'
            });

            const hasConfirmation = /confirm.*submit|ready.*to.*submit/i.test(content);
            assertions.push({
                passed: hasConfirmation,
                message: hasConfirmation ? '‚úì Confirmation dialog' : '‚ö† No confirmation'
            });

            const hasAPI = /fetch.*api.*scores|POST.*quiz/i.test(content);
            assertions.push({
                passed: hasAPI,
                message: hasAPI ? '‚úì API submission' : '‚ö† No API call'
            });

            return { 
                passed: hasSubmit,
                assertions 
            };
        }

        function testResultsDisplay(content) {
            const assertions = [];
            
            const hasResults = /results-container|displayResults|score-display/i.test(content);
            assertions.push({
                passed: hasResults,
                message: hasResults ? '‚úì Results display' : '‚úó No results display'
            });

            const hasDetailed = /questionResults|review|explanation/i.test(content);
            assertions.push({
                passed: hasDetailed,
                message: hasDetailed ? '‚úì Detailed results' : '‚ö† Basic results only'
            });

            return { 
                passed: hasResults,
                assertions 
            };
        }

        function testQuestionTiming(content) {
            const assertions = [];
            
            const hasTiming = /questionTimes|timeTaken|questionStartTime/i.test(content);
            assertions.push({
                passed: hasTiming,
                message: hasTiming ? '‚úì Question timing' : '‚Ñπ No timing tracking'
            });

            return { 
                passed: true,
                warning: !hasTiming,
                assertions 
            };
        }

        // ============================================
        // SPECIALIZED TEST RUNNERS
        // ============================================

        async function runAnswerFormatTests() {
            const formatTests = tests.filter(t => t.category === 'Answer Format');
            await runSpecificTests(formatTests, 'Answer Format Tests');
        }

        async function runValidationTests() {
            const validationTests = tests.filter(t => 
                t.category === 'Normalization' || 
                t.category === 'Error Handling'
            );
            await runSpecificTests(validationTests, 'Validation Tests');
        }

        async function runMissingPiecesTests() {
            const missingTests = tests.filter(t => t.category === 'Missing Pieces');
            await runSpecificTests(missingTests, 'Missing Pieces Analysis');
        }

        async function runSpecificTests(testsList, title) {
            if (uploadedFiles.length === 0) {
                showNotification('Please upload quiz files first!', 'warning');
                return;
            }

            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = `<h2 style="margin-bottom: 20px;">${title}</h2>`;

            let localPassed = 0;
            let localFailed = 0;
            let localWarnings = 0;

            for (let i = 0; i < testsList.length; i++) {
                const test = testsList[i];
                
                renderTest(test, 'running');
                await sleep(50);
                
                const result = test.run();
                
                if (result.passed) localPassed++;
                else if (result.warning) localWarnings++;
                else localFailed++;
                
                renderTest(test, result.warning ? 'warning' : (result.passed ? 'passed' : 'failed'), result);
            }

            document.getElementById('totalTests').textContent = testsList.length;
            document.getElementById('passedTests').textContent = localPassed;
            document.getElementById('failedTests').textContent = localFailed;
            document.getElementById('warningTests').textContent = localWarnings;

            updateCharts();
        }

        // ============================================
        // UI HELPER FUNCTIONS
        // ============================================

        function renderTest(test, status, result = null) {
            const categoryName = test.category;
            let categorySection = document.querySelector(`[data-category-section="${categoryName}"]`);
            
            if (!categorySection) {
                categorySection = document.createElement('div');
                categorySection.className = 'test-category';
                categorySection.setAttribute('data-category-section', categoryName);
                categorySection.innerHTML = `<h3>${categoryName}</h3>`;
                document.getElementById('results').appendChild(categorySection);
            }

            let testElement = document.getElementById(`test-${test.name.replace(/[^a-zA-Z0-9]/g, '-')}`);
            
            if (!testElement) {
                testElement = document.createElement('div');
                testElement.className = 'test-item';
                testElement.id = `test-${test.name.replace(/[^a-zA-Z0-9]/g, '-')}`;
                categorySection.appendChild(testElement);
            }

            testElement.className = `test-item ${status}`;
            
            let html = `
                <div class="test-name">
                    ${status === 'running' ? '<span class="loader"></span>' : ''}
                    ${test.name}
                </div>
                <div class="test-status ${status}">
                    ${status === 'running' ? '‚è≥ RUNNING...' : 
                      status === 'passed' ? '‚úì PASSED' : 
                      status === 'warning' ? '‚ö† WARNING' : '‚úó FAILED'}
                </div>
            `;

            if (result && result.assertions) {
                html += '<div class="test-details">';
                result.assertions.forEach(assertion => {
                    const assertionStatus = assertion.passed ? 'passed' : (status === 'warning' ? 'warning' : 'failed');
                    html += `<div class="assertion ${assertionStatus}">${assertion.message}</div>`;
                });
                html += '</div>';
            }

            testElement.innerHTML = html;
        }

        function updateProgress() {
            const progress = ((currentTest + 1) / tests.length) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${progress}%`;
            progressFill.textContent = `${Math.round(progress)}%`;
        }

        function updateStats() {
            document.getElementById('passedTests').textContent = passed;
            document.getElementById('failedTests').textContent = failed;
            document.getElementById('warningTests').textContent = warnings;
        }

        function updateCharts() {
            drawPieChart();
            drawBarChart();
        }

        function drawPieChart() {
            const canvas = document.getElementById('pieChart');
            const ctx = canvas.getContext('2d');
            const total = passed + failed + warnings || 1;
            
            const data = [
                { value: passed, color: '#2ecc71', label: 'Passed' },
                { value: failed, color: '#e74c3c', label: 'Failed' },
                { value: warnings, color: '#f39c12', label: 'Warnings' }
            ];

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 80;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            let currentAngle = -Math.PI / 2;

            data.forEach(item => {
                const sliceAngle = (item.value / total) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = item.color;
                ctx.fill();
                
                currentAngle += sliceAngle;
            });

            // Draw center circle for donut effect
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.6, 0, 2 * Math.PI);
            ctx.fillStyle = 'white';
            ctx.fill();

            // Draw percentage in center
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const passRate = total > 0 ? Math.round((passed / total) * 100) : 0;
            ctx.fillText(`${passRate}%`, centerX, centerY);
        }

        function drawBarChart() {
            const container = document.getElementById('barChart');
            container.innerHTML = '';

            const categories = Object.keys(categoryStats);
            const maxTotal = Math.max(...categories.map(cat => categoryStats[cat].total), 1);

            categories.forEach(category => {
                const stats = categoryStats[category];
                const successRate = stats.total > 0 ? (stats.passed / stats.total) * 100 : 0;
                
                const barWrapper = document.createElement('div');
                barWrapper.style.flex = '1';
                barWrapper.style.display = 'flex';
                barWrapper.style.flexDirection = 'column';
                barWrapper.style.alignItems = 'center';

                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = `${successRate}%`;
                bar.title = `${category}: ${successRate.toFixed(1)}%`;
                
                if (successRate >= 80) {
                    bar.style.background = 'linear-gradient(to top, #2ecc71, #27ae60)';
                } else if (successRate >= 50) {
                    bar.style.background = 'linear-gradient(to top, #f39c12, #e67e22)';
                } else {
                    bar.style.background = 'linear-gradient(to top, #e74c3c, #c0392b)';
                }

                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = category.split(' ')[0];

                barWrapper.appendChild(bar);
                barWrapper.appendChild(label);
                container.appendChild(barWrapper);
            });
        }

        function updateCategorySummary() {
            const container = document.getElementById('categorySummary');
            container.innerHTML = '';

            Object.keys(categoryStats).forEach(category => {
                const stats = categoryStats[category];
                const successRate = stats.total > 0 ? (stats.passed / stats.total) * 100 : 0;

                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `
                    <h4>${category}</h4>
                    <p style="color: #7f8c8d; font-size: 14px;">
                        ${stats.passed}/${stats.total} passed
                        ${stats.warnings > 0 ? `‚Ä¢ ${stats.warnings} warnings` : ''}
                        ${stats.failed > 0 ? `‚Ä¢ ${stats.failed} failed` : ''}
                    </p>
                    <div class="category-progress">
                        <div class="category-progress-fill" style="width: ${successRate}%; background: ${
                            successRate >= 80 ? '#2ecc71' : successRate >= 50 ? '#f39c12' : '#e74c3c'
                        }"></div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function showSummary() {
            const summary = document.createElement('div');
            const hasFailures = failed > 0;
            const hasWarnings = warnings > 0;
            
            summary.className = `summary ${hasFailures ? 'has-failures' : hasWarnings ? 'has-warnings' : 'all-passed'}`;
            
            const successRate = tests.length > 0 ? ((passed / tests.length) * 100).toFixed(1) : 0;
            
            summary.innerHTML = `
                <h2>${hasFailures ? '‚ö†Ô∏è Tests Completed with Failures' : 
                      hasWarnings ? '‚úì Tests Passed with Warnings' : 
                      'üéâ All Tests Passed!'}</h2>
                <p style="font-size: 20px; margin: 20px 0; color: ${hasFailures ? '#e74c3c' : hasWarnings ? '#f39c12' : '#2ecc71'}">
                    Success Rate: ${successRate}%
                </p>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <strong>Total Tests</strong><br>${tests.length}
                    </div>
                    <div class="summary-stat" style="background: rgba(46, 204, 113, 0.1);">
                        <strong>Passed</strong><br>${passed}
                    </div>
                    <div class="summary-stat" style="background: rgba(231, 76, 60, 0.1);">
                        <strong>Failed</strong><br>${failed}
                    </div>
                    <div class="summary-stat" style="background: rgba(243, 156, 18, 0.1);">
                        <strong>Warnings</strong><br>${warnings}
                    </div>
                    <div class="summary-stat">
                        <strong>Files Tested</strong><br>${uploadedFiles.length}
                    </div>
                </div>
                ${hasFailures ? '<p style="color: #e74c3c; margin-top: 15px; font-weight: 600;">‚ö†Ô∏è Critical issues found - review failed tests</p>' : ''}
                ${hasWarnings && !hasFailures ? '<p style="color: #f39c12; margin-top: 15px; font-weight: 600;">‚ÑπÔ∏è Some improvements recommended - review warnings</p>' : ''}
            `;
            
            const resultsContainer = document.getElementById('results');
            resultsContainer.insertBefore(summary, resultsContainer.firstChild);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üéØ</div>
                    <h3>Ready to Begin Testing</h3>
                    <p style="margin-top: 20px;">Upload quiz files to start testing</p>
                </div>
            `;
            document.getElementById('chartContainer').style.display = 'none';
            document.getElementById('categorySummary').innerHTML = '';
            
            passed = 0;
            failed = 0;
            warnings = 0;
            currentTest = 0;
            categoryStats = {};
            
            updateStats();
            document.getElementById('totalTests').textContent = '0';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressFill').textContent = '0%';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
