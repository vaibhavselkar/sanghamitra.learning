<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Quiz Test Suite - Upload & Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 18px;
            opacity: 0.9;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            min-height: 80vh;
        }

        .sidebar {
            background: #2c3e50;
            color: white;
            padding: 30px 20px;
        }

        .upload-section {
            background: #34495e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .upload-section h3 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .file-upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #2c3e50;
        }

        .file-upload-area:hover {
            border-color: #2ecc71;
            background: #34495e;
        }

        .file-upload-area.drag-over {
            border-color: #2ecc71;
            background: #34495e;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .upload-text {
            font-size: 14px;
            color: #ecf0f1;
        }

        .file-input {
            display: none;
        }

        .uploaded-files {
            margin-top: 15px;
        }

        .file-item {
            background: #2c3e50;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .file-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-icon {
            width: 30px;
            height: 30px;
            background: #3498db;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 11px;
        }

        .file-remove {
            background: #e74c3c;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }

        /* Add these to your existing CSS */
.numeric-test-panel {
    background: #e8f4fd;
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
    border-left: 4px solid #2196f3;
}

.numeric-input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.numeric-input {
    padding: 10px;
    border: 2px solid #3498db;
    border-radius: 6px;
    font-size: 14px;
    flex: 1;
    min-width: 200px;
}

.numeric-result {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    font-family: 'Courier New', monospace;
}

.tolerance-control {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
}

.math-badge {
    display: inline-block;
    padding: 3px 8px;
    background: #4CAF50;
    color: white;
    border-radius: 12px;
    font-size: 11px;
    margin-left: 8px;
}

        .file-remove:hover {
            background: #c0392b;
        }

        .category-list {
            margin-top: 20px;
        }

        .category-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: #34495e;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .category-item:hover {
            background: #3498db;
            transform: translateX(5px);
        }

        .category-item.active {
            background: #3498db;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        .main-content {
            padding: 40px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        .btn-primary:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db 0%, #2ecc71 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .test-category {
            margin-bottom: 30px;
        }

        .test-category h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .test-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #bdc3c7;
        }

        .test-item.passed {
            border-left-color: #2ecc71;
        }

        .test-item.failed {
            border-left-color: #e74c3c;
        }

        .test-item.warning {
            border-left-color: #f39c12;
        }

        .test-item.running {
            border-left-color: #f39c12;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .test-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .test-status {
            font-size: 14px;
            color: #7f8c8d;
        }

        .test-status.passed {
            color: #2ecc71;
        }

        .test-status.failed {
            color: #e74c3c;
        }

        .test-status.warning {
            color: #f39c12;
        }

        .test-details {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .assertion {
            padding: 5px 0;
        }

        .assertion.passed::before {
            content: "‚úì ";
            color: #2ecc71;
            font-weight: bold;
        }

        .assertion.failed::before {
            content: "‚úó ";
            color: #e74c3c;
            font-weight: bold;
        }

        .assertion.warning::before {
            content: "‚ö† ";
            color: #f39c12;
            font-weight: bold;
        }

        .summary {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .summary.all-passed {
            border: 3px solid #2ecc71;
        }

        .summary.has-failures {
            border: 3px solid #e74c3c;
        }

        .summary.has-warnings {
            border: 3px solid #f39c12;
        }

        .summary h2 {
            font-size: 28px;
            margin-bottom: 15px;
        }

        .code-preview {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 16px;
        }

        .file-size {
            font-size: 11px;
            color: #95a5a6;
        }

        .test-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #3498db;
            color: white;
        }

        .filter-btn:hover {
            background: #3498db;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Universal Quiz Test Suite</h1>
            <p>Upload your quiz files (HTML, JS, CSS, images) and run comprehensive tests</p>
        </div>

        <div class="main-layout">
            <div class="sidebar">
                <div class="upload-section">
                    <h3>üìÅ Upload Files</h3>
                    <div class="file-upload-area" id="uploadArea">
                        <div class="upload-icon">üì§</div>
                        <div class="upload-text">
                            <strong>Drop files here</strong><br>
                            or click to browse<br>
                            <small>(HTML, JS, CSS, images, text)</small>
                        </div>
                        <input type="file" id="fileInput" class="file-input" multiple 
                               accept=".html,.htm,.js,.css,.json,.txt,.png,.jpg,.jpeg,.gif,.svg">
                    </div>
                    <div class="uploaded-files" id="uploadedFiles"></div>
                </div>

                <div class="category-list">
                    <h3 style="color: #3498db; margin-bottom: 15px; font-size: 16px;">Test Categories</h3>
                    <div class="category-item active" data-category="all">All Tests</div>
                    <div class="category-item" data-category="A">A. Code Structure</div>
                    <div class="category-item" data-category="B">B. Quiz Logic</div>
                    <div class="category-item" data-category="C">C. UI Components</div>
                    <div class="category-item" data-category="D">D. Answer Handling</div>
                    <div class="category-item" data-category="E">E. Anti-Cheating</div>
                    <div class="category-item" data-category="F">F. Calculator</div>
                    <div class="category-item" data-category="G">G. Security</div>
                    <div class="category-item" data-category="H">H. Performance</div>
                    <div class="category-item" data-category="I">I. Accessibility</div>
                </div>
            </div>

            <div class="main-content">
                <div class="controls">
                    <button class="btn btn-primary" id="runAllBtn" disabled>Run All Tests</button>
                    <button class="btn btn-success" id="analyzeBtn" disabled>Analyze Code</button>
                    <button class="btn btn-danger" id="stopBtn" style="display: none;">Stop Tests</button>
                    <button class="btn btn-secondary" id="resetBtn">Reset</button>
                </div>

                <div class="test-filters" id="testFilters" style="display: none;">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="passed">Passed</button>
                    <button class="filter-btn" data-filter="failed">Failed</button>
                    <button class="filter-btn" data-filter="warning">Warnings</button>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <h3>Total Tests</h3>
                        <div class="value" id="totalTests">0</div>
                    </div>
                    <div class="stat-card success">
                        <h3>Passed</h3>
                        <div class="value" id="passedTests">0</div>
                    </div>
                    <div class="stat-card danger">
                        <h3>Failed</h3>
                        <div class="value" id="failedTests">0</div>
                    </div>
                    <div class="stat-card warning">
                        <h3>Warnings</h3>
                        <div class="value" id="warningTests">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Files Uploaded</h3>
                        <div class="value" id="filesCount">0</div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill">0%</div>
                    </div>
                </div>

                <div class="results" id="results">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3>No Files Uploaded Yet</h3>
                        <p>Upload your quiz files to start testing</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class UniversalQuizTester {
            constructor() {
                this.uploadedFiles = new Map();
                this.tests = [];
                this.currentTest = 0;
                this.passed = 0;
                this.failed = 0;
                this.warnings = 0;
                this.running = false;
                this.parsedCode = {
                    html: null,
                    js: null,
                    css: null,
                    images: [],
                    other: []
                };
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');

                // Click to upload
                uploadArea.addEventListener('click', () => fileInput.click());

                // File input change
                fileInput.addEventListener('change', (e) => {
                    this.handleFiles(e.target.files);
                });

                // Drag and drop
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('drag-over');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('drag-over');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-over');
                    this.handleFiles(e.dataTransfer.files);
                });

                // Control buttons
                document.getElementById('runAllBtn').addEventListener('click', () => this.runAllTests());
                document.getElementById('analyzeBtn').addEventListener('click', () => this.analyzeCode());
                document.getElementById('stopBtn').addEventListener('click', () => this.stop());
                document.getElementById('resetBtn').addEventListener('click', () => this.reset());

                // Category filters
                document.querySelectorAll('.category-item').forEach(item => {
                    item.addEventListener('click', () => {
                        document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        this.filterByCategory(item.getAttribute('data-category'));
                    });
                });

                // Test filters
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.filterTests(btn.getAttribute('data-filter'));
                    });
                });
            }

            handleFiles(files) {
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        const fileData = {
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            content: e.target.result,
                            extension: file.name.split('.').pop().toLowerCase()
                        };

                        this.uploadedFiles.set(file.name, fileData);
                        this.categorizeFile(fileData);
                        this.renderUploadedFiles();
                        this.updateFileCount();
                        this.enableButtons();
                    };

                    if (file.type.startsWith('image/')) {
                        reader.readAsDataURL(file);
                    } else {
                        reader.readAsText(file);
                    }
                });
            }

            categorizeFile(fileData) {
                const ext = fileData.extension;
                
                if (ext === 'html' || ext === 'htm') {
                    this.parsedCode.html = fileData;
                } else if (ext === 'js') {
                    this.parsedCode.js = fileData;
                } else if (ext === 'css') {
                    this.parsedCode.css = fileData;
                } else if (['png', 'jpg', 'jpeg', 'gif', 'svg'].includes(ext)) {
                    this.parsedCode.images.push(fileData);
                } else {
                    this.parsedCode.other.push(fileData);
                }
            }

            renderUploadedFiles() {
                const container = document.getElementById('uploadedFiles');
                container.innerHTML = '';

                this.uploadedFiles.forEach((file, name) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    const ext = file.extension.toUpperCase();
                    const size = this.formatFileSize(file.size);
                    
                    fileItem.innerHTML = `
                        <div class="file-item-info">
                            <div class="file-icon">${ext}</div>
                            <div>
                                <div style="font-weight: 600;">${file.name}</div>
                                <div class="file-size">${size}</div>
                            </div>
                        </div>
                        <button class="file-remove" data-filename="${name}">Remove</button>
                    `;
                    
                    container.appendChild(fileItem);
                });

                // Add remove listeners
                document.querySelectorAll('.file-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const filename = e.target.getAttribute('data-filename');
                        this.removeFile(filename);
                    });
                });
            }

            removeFile(filename) {
                this.uploadedFiles.delete(filename);
                this.renderUploadedFiles();
                this.updateFileCount();
                
                if (this.uploadedFiles.size === 0) {
                    this.disableButtons();
                    document.getElementById('results').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <h3>No Files Uploaded Yet</h3>
                            <p>Upload your quiz files to start testing</p>
                        </div>
                    `;
                }
            }

            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            }

            updateFileCount() {
                document.getElementById('filesCount').textContent = this.uploadedFiles.size;
            }

            enableButtons() {
                document.getElementById('runAllBtn').disabled = false;
                document.getElementById('analyzeBtn').disabled = false;
            }

            disableButtons() {
                document.getElementById('runAllBtn').disabled = true;
                document.getElementById('analyzeBtn').disabled = true;
            }

            analyzeCode() {
                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = '<h3 style="margin-bottom: 20px;">üìä Code Analysis</h3>';

                const analysisResults = [];

                // Analyze HTML
                if (this.parsedCode.html) {
                    const htmlAnalysis = this.analyzeHTML(this.parsedCode.html.content);
                    analysisResults.push({
                        title: 'HTML Structure Analysis',
                        items: htmlAnalysis
                    });
                }

                // Analyze JavaScript
                if (this.parsedCode.js) {
                    const jsAnalysis = this.analyzeJavaScript(this.parsedCode.js.content);
                    analysisResults.push({
                        title: 'JavaScript Code Analysis',
                        items: jsAnalysis
                    });
                }

                // Analyze CSS
                if (this.parsedCode.css) {
                    const cssAnalysis = this.analyzeCSS(this.parsedCode.css.content);
                    analysisResults.push({
                        title: 'CSS Stylesheet Analysis',
                        items: cssAnalysis
                    });
                }

                // Render analysis
                analysisResults.forEach(section => {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'test-category';
                    sectionDiv.innerHTML = `<h3>${section.title}</h3>`;

                    section.items.forEach(item => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = `test-item ${item.status}`;
                        itemDiv.innerHTML = `
                            <div class="test-name">${item.name}</div>
                            <div class="test-status ${item.status}">${item.message}</div>
                            ${item.details ? `<div class="test-details">${item.details}</div>` : ''}
                        `;
                        sectionDiv.appendChild(itemDiv);
                    });

                    resultsContainer.appendChild(sectionDiv);
                });
            }

            analyzeHTML(content) {
                const results = [];
                
                // Check for basic structure
                results.push({
                    name: 'DOCTYPE Declaration',
                    status: content.includes('<!DOCTYPE') ? 'passed' : 'warning',
                    message: content.includes('<!DOCTYPE') ? '‚úì DOCTYPE found' : '‚ö† No DOCTYPE declaration'
                });

                // Check for meta viewport
                results.push({
                    name: 'Responsive Meta Tag',
                    status: content.includes('viewport') ? 'passed' : 'warning',
                    message: content.includes('viewport') ? '‚úì Viewport meta tag present' : '‚ö† No viewport meta tag'
                });

                // Check for script tags
                const scriptCount = (content.match(/<script/g) || []).length;
                results.push({
                    name: 'JavaScript Files',
                    status: scriptCount > 0 ? 'passed' : 'warning',
                    message: `Found ${scriptCount} script tag(s)`
                });

                // Check for form elements
                const hasForm = content.includes('<form') || content.includes('<input');
                results.push({
                    name: 'Form Elements',
                    status: hasForm ? 'passed' : 'warning',
                    message: hasForm ? '‚úì Form elements detected' : '‚ö† No form elements found'
                });

                // Check for quiz-related elements
                const quizElements = ['question', 'answer', 'quiz', 'test', 'option', 'choice'];
                const foundElements = quizElements.filter(el => 
                    content.toLowerCase().includes(el)
                );
                
                results.push({
                    name: 'Quiz-Related Elements',
                    status: foundElements.length > 0 ? 'passed' : 'warning',
                    message: foundElements.length > 0 
                        ? `‚úì Found keywords: ${foundElements.join(', ')}` 
                        : '‚ö† No quiz-related keywords found',
                    details: foundElements.length > 0 ? foundElements.join(', ') : null
                });

                return results;
            }

            analyzeJavaScript(content) {
                const results = [];

                // Check for functions
                const functionCount = (content.match(/function\s+\w+/g) || []).length;
                const arrowFunctionCount = (content.match(/=>\s*{/g) || []).length;
                results.push({
                    name: 'Functions Defined',
                    status: (functionCount + arrowFunctionCount) > 0 ? 'passed' : 'warning',
                    message: `Found ${functionCount} regular functions, ${arrowFunctionCount} arrow functions`
                });

                // Check for event listeners
                const eventListeners = (content.match(/addEventListener/g) || []).length;
                results.push({
                    name: 'Event Listeners',
                    status: eventListeners > 0 ? 'passed' : 'warning',
                    message: `Found ${eventListeners} event listener(s)`
                });

                // Check for common quiz functions
                const quizFunctions = ['submit', 'check', 'validate', 'answer', 'score', 'calculate'];
                const foundFunctions = quizFunctions.filter(fn => 
                    content.toLowerCase().includes(fn)
                );
                
                results.push({
                    name: 'Quiz Logic Functions',
                    status: foundFunctions.length > 0 ? 'passed' : 'warning',
                    message: `Found ${foundFunctions.length} quiz-related function(s)`,
                    details: foundFunctions.join(', ')
                });

                // Check for DOM manipulation
                const domMethods = ['getElementById', 'querySelector', 'createElement'];
                const foundDOM = domMethods.filter(method => content.includes(method));
                results.push({
                    name: 'DOM Manipulation',
                    status: foundDOM.length > 0 ? 'passed' : 'warning',
                    message: `Uses: ${foundDOM.join(', ') || 'None found'}`
                });

                // Check for infinity handling
                results.push({
                    name: 'Infinity Symbol Support',
                    status: content.includes('‚àû') || content.includes('infinity') ? 'passed' : 'warning',
                    message: content.includes('‚àû') || content.includes('infinity') 
                        ? '‚úì Infinity handling detected' 
                        : '‚ö† No infinity handling found'
                });

                return results;
            }

            analyzeCSS(content) {
                const results = [];

                // Count rules
                const ruleCount = (content.match(/{/g) || []).length;
                results.push({
                    name: 'CSS Rules',
                    status: ruleCount > 0 ? 'passed' : 'warning',
                    message: `Found ${ruleCount} CSS rule(s)`
                });

                // Check for responsive design
                const mediaQueries = (content.match(/@media/g) || []).length;
                results.push({
                    name: 'Responsive Design',
                    status: mediaQueries > 0 ? 'passed' : 'warning',
                    message: mediaQueries > 0 
                        ? `‚úì ${mediaQueries} media query/queries found` 
                        : '‚ö† No media queries found'
                });

                // Check for animations
                const hasAnimations = content.includes('@keyframes') || content.includes('animation');
                results.push({
                    name: 'Animations',
                    status: hasAnimations ? 'passed' : 'warning',
                    message: hasAnimations ? '‚úì Animations found' : '‚ö† No animations'
                });

                // Check for flexbox/grid
                const hasFlexbox = content.includes('flex');
                const hasGrid = content.includes('grid');
                results.push({
                    name: 'Modern Layout',
                    status: (hasFlexbox || hasGrid) ? 'passed' : 'warning',
                    message: `Flexbox: ${hasFlexbox ? 'Yes' : 'No'}, Grid: ${hasGrid ? 'Yes' : 'No'}`
                });

                return results;
            }

            async runAllTests() {
                if (this.uploadedFiles.size === 0) {
                    alert('Please upload files first!');
                    return;
                }

                this.running = true;
                this.currentTest = 0;
                this.passed = 0;
                this.failed = 0;
                this.warnings = 0;

                document.getElementById('runAllBtn').style.display = 'none';
                document.getElementById('analyzeBtn').style.display = 'none';
                document.getElementById('stopBtn').style.display = 'inline-block';
                document.getElementById('testFilters').style.display = 'flex';

                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = '';

                // Generate dynamic tests based on uploaded files
                this.tests = this.generateDynamicTests();
                document.getElementById('totalTests').textContent = this.tests.length;

                for (let i = 0; i < this.tests.length; i++) {
                    if (!this.running) break;

                    this.currentTest = i;
                    const test = this.tests[i];
                    
                    this.updateProgress();
                    this.renderTest(test, 'running');
                    
                    await this.sleep(150);
                    
                    const result = test.run();
                    
                    if (result.passed) {
                        this.passed++;
                    } else if (result.warning) {
                        this.warnings++;
                    } else {
                        this.failed++;
                    }
                    
                    this.renderTest(test, result.warning ? 'warning' : (result.passed ? 'passed' : 'failed'), result);
                    this.updateStats();
                }

                this.running = false;
                this.showSummary();
                document.getElementById('runAllBtn').style.display = 'inline-block';
                document.getElementById('analyzeBtn').style.display = 'inline-block';
                document.getElementById('stopBtn').style.display = 'none';
            }

            generateDynamicTests() {
                const tests = [];

                // Category A: Code Structure Tests
                if (this.parsedCode.html) {
                    tests.push({
                        category: 'A',
                        name: 'HTML Structure Validation',
                        run: () => this.testHTMLStructure()
                    });
                    tests.push({
                        category: 'A',
                        name: 'Required HTML Elements',
                        run: () => this.testRequiredElements()
                    });
                }

                if (this.parsedCode.js) {
                    tests.push({
                        category: 'A',
                        name: 'JavaScript Syntax Check',
                        run: () => this.testJSSyntax()
                    });
                }

                if (this.parsedCode.css) {
                    tests.push({
                        category: 'A',
                        name: 'CSS Syntax Validation',
                        run: () => this.testCSSSyntax()
                    });
                }

                // Category B: Quiz Logic Tests
                tests.push({
                    category: 'B',
                    name: 'Question Handling Logic',
                    run: () => this.testQuestionLogic()
                });

                tests.push({
                    category: 'B',
                    name: 'Answer Processing',
                    run: () => this.testAnswerProcessing()
                });

                tests.push({
                    category: 'B',
                    name: 'Score Calculation',
                    run: () => this.testScoreCalculation()
                });

                // Category C: UI Components
                tests.push({
                    category: 'C',
                    name: 'Form Elements Present',
                    run: () => this.testFormElements()
                });

                tests.push({
                    category: 'C',
                    name: 'Navigation Controls',
                    run: () => this.testNavigationControls()
                });

                // Category D: Answer Handling
                tests.push({
                    category: 'D',
                    name: 'Infinity Symbol Conversion',
                    run: () => this.testInfinityConversion()
                });

                tests.push({
                    category: 'D',
                    name: 'Answer Normalization',
                    run: () => this.testAnswerNormalization()
                });

                // Category E: Anti-Cheating
                tests.push({
                    category: 'E',
                    name: 'Tab Switch Detection',
                    run: () => this.testTabDetection()
                });

                tests.push({
                    category: 'E',
                    name: 'Copy-Paste Prevention',
                    run: () => this.testCopyPasteDetection()
                });

                // Category F: Calculator
                tests.push({
                    category: 'F',
                    name: 'Calculator Presence',
                    run: () => this.testCalculatorPresence()
                });

                // Category G: Security
                tests.push({
                    category: 'G',
                    name: 'XSS Prevention',
                    run: () => this.testXSSPrevention()
                });

                tests.push({
                    category: 'G',
                    name: 'Input Sanitization',
                    run: () => this.testInputSanitization()
                });

                // Category H: Performance
                tests.push({
                    category: 'H',
                    name: 'Code Size Optimization',
                    run: () => this.testCodeSize()
                });

                tests.push({
                    category: 'H',
                    name: 'Script Loading',
                    run: () => this.testScriptLoading()
                });

                // Category I: Accessibility
                tests.push({
                    category: 'I',
                    name: 'Semantic HTML',
                    run: () => this.testSemanticHTML()
                });

                tests.push({
                    category: 'I',
                    name: 'ARIA Labels',
                    run: () => this.testARIALabels()
                });

                return tests;
            }

            // Test Implementations
            testHTMLStructure() {
                const content = this.parsedCode.html?.content || '';
                const assertions = [];

                const hasDoctype = content.includes('<!DOCTYPE');
                assertions.push({
                    passed: hasDoctype,
                    message: hasDoctype ? '‚úì DOCTYPE declaration present' : '‚úó Missing DOCTYPE'
                });

                const hasHead = content.includes('<head');
                assertions.push({
                    passed: hasHead,
                    message: hasHead ? '‚úì Head section found' : '‚úó Missing head section'
                });

                const hasBody = content.includes('<body');
                assertions.push({
                    passed: hasBody,
                    message: hasBody ? '‚úì Body section found' : '‚úó Missing body section'
                });

                const allPassed = assertions.every(a => a.passed);
                return { passed: allPassed, assertions };
            }

            testRequiredElements() {
                const content = this.parsedCode.html?.content || '';
                const assertions = [];

                const elements = ['form', 'input', 'button'];
                elements.forEach(el => {
                    const found = content.includes(`<${el}`);
                    assertions.push({
                        passed: found,
                        message: found ? `‚úì <${el}> element found` : `‚ö† <${el}> element missing`
                    });
                });

                const anyFound = assertions.some(a => a.passed);
                return { passed: true, warning: !anyFound, assertions };
            }

            testJSSyntax() {
                const content = this.parsedCode.js?.content || '';
                const assertions = [];

                try {
                    // Basic syntax checks
                    const hasFunctions = /function\s+\w+/.test(content) || /=>\s*{/.test(content);
                    assertions.push({
                        passed: hasFunctions,
                        message: hasFunctions ? '‚úì Functions defined' : '‚ö† No functions found'
                    });

                    const hasEventListeners = content.includes('addEventListener');
                    assertions.push({
                        passed: hasEventListeners,
                        message: hasEventListeners ? '‚úì Event listeners present' : '‚ö† No event listeners'
                    });

                    return { passed: true, warning: !hasFunctions && !hasEventListeners, assertions };
                } catch (e) {
                    return { 
                        passed: false, 
                        assertions: [{ passed: false, message: `‚úó Syntax error: ${e.message}` }] 
                    };
                }
            }

            testCSSSyntax() {
                const content = this.parsedCode.css?.content || '';
                const assertions = [];

                const ruleCount = (content.match(/{/g) || []).length;
                assertions.push({
                    passed: ruleCount > 0,
                    message: `${ruleCount > 0 ? '‚úì' : '‚ö†'} ${ruleCount} CSS rules found`
                });

                const hasMediaQueries = content.includes('@media');
                assertions.push({
                    passed: hasMediaQueries,
                    message: hasMediaQueries ? '‚úì Responsive design (media queries)' : '‚ö† No media queries'
                });

                return { passed: true, warning: ruleCount === 0, assertions };
            }

            testQuestionLogic() {
                const jsContent = this.parsedCode.js?.content || '';
                const htmlContent = this.parsedCode.html?.content || '';
                const combined = jsContent + htmlContent;

                const assertions = [];
                const keywords = ['question', 'quiz', 'test'];
                const found = keywords.some(kw => combined.toLowerCase().includes(kw));

                assertions.push({
                    passed: found,
                    message: found ? '‚úì Question-related logic detected' : '‚ö† No question logic found'
                });

                return { passed: true, warning: !found, assertions };
            }

            testAnswerProcessing() {
                const content = this.parsedCode.js?.content || '';
                const assertions = [];

                const hasAnswerLogic = /answer/.test(content.toLowerCase());
                assertions.push({
                    passed: hasAnswerLogic,
                    message: hasAnswerLogic ? '‚úì Answer processing code found' : '‚ö† No answer processing'
                });

                return { passed: true, warning: !hasAnswerLogic, assertions };
            }

            testScoreCalculation() {
                const content = this.parsedCode.js?.content || '';
                const assertions = [];

                const hasScoring = /score|calculate|grade/.test(content.toLowerCase());
                assertions.push({
                    passed: hasScoring,
                    message: hasScoring ? '‚úì Scoring logic detected' : '‚ö† No scoring logic found'
                });

                return { passed: true, warning: !hasScoring, assertions };
            }

            testFormElements() {
                const content = this.parsedCode.html?.content || '';
                const assertions = [];

                const formElements = ['input', 'button', 'select', 'textarea'];
                formElements.forEach(el => {
                    const found = content.includes(`<${el}`);
                    if (found) {
                        assertions.push({
                            passed: true,
                            message: `‚úì <${el}> element found`
                        });
                    }
                });

                if (assertions.length === 0) {
                    assertions.push({
                        passed: false,
                        message: '‚ö† No form elements found'
                    });
                }

                return { passed: assertions.length > 0, assertions };
            }

            testNavigationControls() {
                const combined = (this.parsedCode.html?.content || '') + (this.parsedCode.js?.content || '');
                const assertions = [];

                const navKeywords = ['next', 'previous', 'submit', 'navigation'];
                const found = navKeywords.filter(kw => combined.toLowerCase().includes(kw));

                assertions.push({
                    passed: found.length > 0,
                    message: found.length > 0 
                        ? `‚úì Navigation controls: ${found.join(', ')}` 
                        : '‚ö† No navigation controls found'
                });

                return { passed: true, warning: found.length === 0, assertions };
            }

            testInfinityConversion() {
                const content = this.parsedCode.js?.content || '';
                const assertions = [];

                const hasInfinity = content.includes('‚àû') || /infinity|inf/.test(content.toLowerCase());
                assertions.push({
                    passed: hasInfinity,
                    message: hasInfinity 
                        ? '‚úì Infinity symbol handling detected' 
                        : '‚ö† No infinity handling found'
                });

                // Test actual conversion if we find the code
                if (content.includes('normalize') || content.includes('convert')) {
                    assertions.push({
                        passed: true,
                        message: '‚úì Normalization/conversion logic present'
                    });
                }

                return { passed: true, warning: !hasInfinity, assertions };
            }

            testAnswerNormalization() {
                const content = this.parsedCode.js?.content || '';
                const assertions = [];

                const hasNormalization = /normalize|trim|toLowerCase|toUpperCase/.test(content);
                assertions.push({
                    passed: hasNormalization,
                    message: hasNormalization 
                        ? '‚úì Answer normalization detected' 
                        : '‚ö† No normalization logic found'
                });

                return { passed: true, warning: !hasNormalization, assertions };
            }

            testTabDetection() {
                const content = this.parsedCode.js?.content || '';
                const assertions = [];

                const hasTabDetection = /blur|focus|visibilitychange/.test(content);
                assertions.push({
                    passed: hasTabDetection,
                    message: hasTabDetection 
                        ? '‚úì Tab/focus detection implemented' 
                        : '‚ö† No tab detection found'
                });

                return { passed: true, warning: !hasTabDetection, assertions };
            }

            testCopyPasteDetection() {
                const content = this.parsedCode.js?.content || '';
                const assertions = [];

                const hasCopyPaste = /copy|paste|contextmenu/.test(content);
                assertions.push({
                    passed: hasCopyPaste,
                    message: hasCopyPaste 
                        ? '‚úì Copy/paste detection found' 
                        : '‚ö† No copy/paste prevention'
                });

                return { passed: true, warning: !hasCopyPaste, assertions };
            }

            testCalculatorPresence() {
                const combined = (this.parsedCode.html?.content || '') + (this.parsedCode.js?.content || '');
                const assertions = [];

                const hasCalculator = /calculator|calc|compute/.test(combined.toLowerCase());
                assertions.push({
                    passed: hasCalculator,
                    message: hasCalculator ? '‚úì Calculator functionality found' : '‚ö† No calculator found'
                });

                return { passed: true, warning: !hasCalculator, assertions };
            }

            testXSSPrevention() {
                const content = this.parsedCode.js?.content || '';
                const assertions = [];

                const hasSanitization = /innerHTML|textContent|sanitize|escape/.test(content);
                const usesInnerHTML = content.includes('innerHTML');

                if (usesInnerHTML) {
                    assertions.push({
                        passed: false,
                        message: '‚ö† WARNING: innerHTML usage detected - potential XSS risk'
                    });
                } else {
                    assertions.push({
                        passed: true,
                        message: '‚úì No innerHTML usage detected'
                    });
                }

                return { passed: !usesInnerHTML, warning: usesInnerHTML, assertions };
            }

            testInputSanitization() {
                const content = this.parsedCode.js?.content || '';
                const assertions = [];

                const hasSanitization = /trim|escape|sanitize|validate/.test(content);
                assertions.push({
                    passed: hasSanitization,
                    message: hasSanitization 
                        ? '‚úì Input sanitization present' 
                        : '‚ö† No input sanitization found'
                });

                return { passed: true, warning: !hasSanitization, assertions };
            }

            testCodeSize() {
                const assertions = [];
                let totalSize = 0;

                this.uploadedFiles.forEach(file => {
                    totalSize += file.size;
                });

                const sizeMB = (totalSize / (1024 * 1024)).toFixed(2);
                const isOptimal = totalSize < 500000; // Less than 500KB is good

                assertions.push({
                    passed: isOptimal,
                    message: `Total code size: ${sizeMB}MB ${isOptimal ? '‚úì Optimal' : '‚ö† Could be optimized'}`
                });

                return { passed: true, warning: !isOptimal, assertions };
            }

            testScriptLoading() {
                const content = this.parsedCode.html?.content || '';
                const assertions = [];

                const hasDefer = content.includes('defer');
                const hasAsync = content.includes('async');

                assertions.push({
                    passed: hasDefer || hasAsync,
                    message: (hasDefer || hasAsync) 
                        ? '‚úì Async/defer script loading' 
                        : '‚ö† No async/defer attributes'
                });

                return { passed: true, warning: !(hasDefer || hasAsync), assertions };
            }

            testSemanticHTML() {
                const content = this.parsedCode.html?.content || '';
                const assertions = [];

                const semanticTags = ['header', 'main', 'section', 'article', 'nav', 'footer'];
                const found = semanticTags.filter(tag => content.includes(`<${tag}`));

                assertions.push({
                    passed: found.length > 0,
                    message: found.length > 0 
                        ? `‚úì Semantic tags used: ${found.join(', ')}` 
                        : '‚ö† No semantic HTML tags'
                });

                return { passed: true, warning: found.length === 0, assertions };
            }

            testARIALabels() {
                const content = this.parsedCode.html?.content || '';
                const assertions = [];

                const hasARIA = /aria-|role=/.test(content);
                assertions.push({
                    passed: hasARIA,
                    message: hasARIA ? '‚úì ARIA attributes found' : '‚ö† No ARIA labels'
                });

                return { passed: true, warning: !hasARIA, assertions };
            }

            renderTest(test, status, result = null) {
                const categoryName = this.getCategoryName(test.category);
                let categorySection = document.querySelector(`[data-category-section="${test.category}"]`);
                
                if (!categorySection) {
                    categorySection = document.createElement('div');
                    categorySection.className = 'test-category';
                    categorySection.setAttribute('data-category-section', test.category);
                    categorySection.innerHTML = `<h3>${test.category}. ${categoryName}</h3>`;
                    document.getElementById('results').appendChild(categorySection);
                }

                let testElement = document.getElementById(`test-${test.category}-${test.name.replace(/\s+/g, '-')}`);
                
                if (!testElement) {
                    testElement = document.createElement('div');
                    testElement.className = 'test-item';
                    testElement.id = `test-${test.category}-${test.name.replace(/\s+/g, '-')}`;
                    categorySection.appendChild(testElement);
                }

                testElement.className = `test-item ${status}`;
                testElement.setAttribute('data-status', status);
                
                let html = `
                    <div class="test-name">${test.name}</div>
                    <div class="test-status ${status}">
                        ${status === 'running' ? 'RUNNING...' : 
                          status === 'passed' ? '‚úì PASSED' : 
                          status === 'warning' ? '‚ö† WARNING' : '‚úó FAILED'}
                    </div>
                `;

                if (result && result.assertions) {
                    html += '<div class="test-details">';
                    result.assertions.forEach(assertion => {
                        const assertionStatus = assertion.passed ? 'passed' : (status === 'warning' ? 'warning' : 'failed');
                        html += `<div class="assertion ${assertionStatus}">${assertion.message}</div>`;
                    });
                    html += '</div>';
                }

                testElement.innerHTML = html;
            }

            getCategoryName(category) {
                const names = {
                    'A': 'Code Structure',
                    'B': 'Quiz Logic',
                    'C': 'UI Components',
                    'D': 'Answer Handling',
                    'E': 'Anti-Cheating',
                    'F': 'Calculator',
                    'G': 'Security',
                    'H': 'Performance',
                    'I': 'Accessibility'
                };
                return names[category] || 'Unknown Category';
            }

            updateProgress() {
                const progress = ((this.currentTest + 1) / this.tests.length) * 100;
                const progressFill = document.getElementById('progressFill');
                progressFill.style.width = `${progress}%`;
                progressFill.textContent = `${Math.round(progress)}%`;
            }

            updateStats() {
                document.getElementById('passedTests').textContent = this.passed;
                document.getElementById('failedTests').textContent = this.failed;
                document.getElementById('warningTests').textContent = this.warnings;
            }

            showSummary() {
                const summary = document.createElement('div');
                const hasFailures = this.failed > 0;
                const hasWarnings = this.warnings > 0;
                
                summary.className = `summary ${hasFailures ? 'has-failures' : hasWarnings ? 'has-warnings' : 'all-passed'}`;
                
                summary.innerHTML = `
                    <h2>${hasFailures ? '‚ö†Ô∏è Tests Completed with Failures' : 
                          hasWarnings ? '‚úì Tests Passed with Warnings' : 
                          'üéâ All Tests Passed!'}</h2>
                    <p><strong>Total Tests:</strong> ${this.tests.length}</p>
                    <p><strong>Passed:</strong> ${this.passed}</p>
                    <p><strong>Failed:</strong> ${this.failed}</p>
                    <p><strong>Warnings:</strong> ${this.warnings}</p>
                    <p><strong>Files Tested:</strong> ${this.uploadedFiles.size}</p>
                `;
                
                const resultsContainer = document.getElementById('results');
                resultsContainer.insertBefore(summary, resultsContainer.firstChild);
            }

            filterByCategory(category) {
                const categories = document.querySelectorAll('[data-category-section]');
                
                if (category === 'all') {
                    categories.forEach(cat => cat.style.display = 'block');
                } else {
                    categories.forEach(cat => {
                        cat.style.display = cat.getAttribute('data-category-section') === category ? 'block' : 'none';
                    });
                }
            }

            filterTests(filter) {
                const testItems = document.querySelectorAll('.test-item');
                
                testItems.forEach(item => {
                    if (filter === 'all') {
                        item.style.display = 'block';
                    } else {
                        const status = item.getAttribute('data-status');
                        item.style.display = status === filter ? 'block' : 'none';
                    }
                });
            }

            stop() {
                this.running = false;
            }

            reset() {
                this.currentTest = 0;
                this.passed = 0;
                this.failed = 0;
                this.warnings = 0;
                this.running = false;
                this.tests = [];
                
                document.getElementById('results').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3>Tests Reset</h3>
                        <p>Upload files and run tests again</p>
                    </div>
                `;
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('progressFill').textContent = '0%';
                document.getElementById('passedTests').textContent = '0';
                document.getElementById('failedTests').textContent = '0';
                document.getElementById('warningTests').textContent = '0';
                document.getElementById('totalTests').textContent = '0';
                document.getElementById('testFilters').style.display = 'none';
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Initialize the test suite
        const tester = new UniversalQuizTester();
    </script>
</body>
</html>
