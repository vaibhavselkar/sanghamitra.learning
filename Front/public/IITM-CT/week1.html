<!DOCTYPE html>      
<html lang="en">    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Computational Thinking - Week 1 Quiz</title>
   
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }

        /* Anti-cheating CSS */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            -webkit-print-color-adjust: exact;
            pointer-events: auto;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }
        
        body.blurred {
            filter: blur(5px);
            pointer-events: none;
        }
        
        .warning-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(220, 53, 69, 0.95);
            color: white;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-size: 2rem;
            text-align: center;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled { 
            background: #6c757d; 
            cursor: not-allowed; 
            transform: none; 
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-container {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quiz-container { 
            padding: 30px; 
            display: none; 
        }

        /* SPLIT SCREEN LAYOUT */
        .question-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            min-height: 500px;
            margin-bottom: 25px;
        }

        /* Left side - Question */
        .question-side {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            border-left: 5px solid #667eea;
            overflow-y: auto;
            max-height: 600px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .question-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .difficulty-badge {
            font-size: 0.75rem;
            padding: 4px 12px;
            border-radius: 12px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .difficulty-easy { background: #d4edda; color: #155724; }
        .difficulty-medium { background: #fff3cd; color: #856404; }
        .difficulty-hard { background: #f8d7da; color: #721c24; }

        .parent-statement {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-weight: 500;
            color: #333;
        }

        .question-text {
            font-size: 1.15rem;
            line-height: 1.7;
            color: #333;
            white-space: pre-line;
        }

        .dataset-badge {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 15px;
        }

        .points-badge {
            background: #f0f0f0;
            color: #666;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        /* Right side - Answers */
        .answer-side {
            background: white;
            border-radius: 12px;
            padding: 30px;
            border: 2px solid #e9ecef;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
            max-height: 600px;
        }

        .answer-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .answer-header h3 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .answer-instruction {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        /* MCQ/MSQ Options */
        .options { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }

        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover { 
            border-color: #667eea; 
            background: #f0f8ff;
            transform: translateX(5px);
        }

        .option.selected { 
            border-color: #667eea; 
            background: #e3f2fd;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .option label {
            cursor: pointer;
            flex: 1;
            font-size: 1rem;
            color: #333;
        }

        /* Input fields */
        .input-container {
            text-align: center;
        }

        .numeric-input,
        .text-input {
            width: 100%;
            max-width: 500px;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1.1rem;
            text-align: center;
            transition: all 0.2s ease;
        }

        .numeric-input:focus,
        .text-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .format-help {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }

        /* Navigation */
        .question-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .btn-nav {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.2s ease;
        }

        .btn-nav:hover:not(:disabled) {
            background: #545b62;
            transform: translateY(-1px);
        }

        .btn-nav:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-next {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-next:hover:not(:disabled) {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }

        .question-status {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }

        .status-answered {
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-unanswered {
            background: #dc3545;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Results */
        .results-container {
            display: none;
            padding: 30px;
            text-align: center;
            max-height: 80vh;
            overflow-y: auto;
        }

        .score-display {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .score-display h2 { font-size: 2.5rem; margin-bottom: 10px; }

        /* Responsive */
        @media (max-width: 1024px) {
            .question-split {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .question-side,
            .answer-side {
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .question-text {
                font-size: 1rem;
            }

            .score-display h2 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Computational Thinking - Week 1</h1>
            <p>Programming Basics Assessment</p>
        </div>

        <!-- Quiz Container -->
        <div id="quizContainer" class="quiz-container" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text">
                    <span id="progressText">Question 1 of 50</span>
                    <span id="answeredStatus" class="status-unanswered">Unanswered</span>
                </div>
            </div>
            
            <div id="questionContainer"></div>
            
            <div class="question-navigation">
                <button class="btn-nav" id="prevBtn" onclick="previousQuestion()" disabled>
                    ‚Üê Previous
                </button>
                <div class="question-status">
                    <span id="questionStatus">Question 1 of 50</span>
                </div>
                <button class="btn-nav btn-next" id="nextBtn" onclick="nextQuestion()">
                    Next ‚Üí
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #667eea;">
                <button class="btn" onclick="submitQuiz()" id="submitBtn">
                    <span id="submitText">üìù Submit CT Week 1 Quiz</span>
                    <span id="submitLoading" class="loading" style="display: none;"></span>
                </button>
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="loadingScreen" class="quiz-container" style="text-align: center; padding: 60px;">
            <div class="loading" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
            <h3>Loading CT Week 1 Quiz...</h3>
            <p>Verifying your session and preparing questions</p>
        </div>

        <!-- Results -->
        <div id="resultsContainer" class="results-container">
            <div class="score-display">
                <h2 id="finalScore">0/100 Points</h2>
                <p>Quiz Completed Successfully!</p>
            </div>
            <button class="btn" onclick="goback()">üè† Back to CT Home</button>
        </div>
    </div>

    <!-- Anti-cheating warning overlay -->
    <div id="warningOverlay" class="warning-overlay">
        <div>
            <h2>‚ö†Ô∏è CHEATING ATTEMPT DETECTED</h2>
            <p>Please return to the quiz window</p>
            <p>Your activity is being monitored</p>
        </div>
    </div>

    <script>
(() => {
  let userAnswers = {};
  let currentUser = {};
  let username = null;
  let email = null;
  let currentQuestionIndex = 0;
  let quizStartTime = null;
  let questionStartTime = null;
  let questionTimes = {};
  let questions = [];
  let cheatingAttempts = 0;
  let isQuizActive = false;
  let autosaveTimer = null;

  let topic = getTopicFromURL() || 'Programming Basics';
  const LS_PREFIX = 'ct_quiz_v1';
  const LS_KEY = `${LS_PREFIX}_${sanitizeKey(topic)}_progress`;

  function sanitizeKey(s) {
    return s.toString().replace(/\s+/g, '_').replace(/[^\w\-]/g, '').toLowerCase();
  }

  function getTopicFromURL() {
    const params = new URLSearchParams(window.location.search);
    const t = params.get('topic');
    return t ? t : null;
  }

  function safeLog(...args) {
    console.log('[CT QUIZ]', ...args);
  }

  function loadSavedProgress() {
    try {
      const raw = localStorage.getItem(LS_KEY);
      if (!raw) return false;
      const parsed = JSON.parse(raw);
      userAnswers = parsed.userAnswers || {};
      questionTimes = parsed.questionTimes || {};
      currentQuestionIndex = parsed.currentQuestionIndex || 0;
      return true;
    } catch (e) {
      return false;
    }
  }

  function saveProgressToLocal() {
    try {
      const payload = {
        userAnswers,
        questionTimes,
        currentQuestionIndex,
        savedAt: new Date()
      };
      localStorage.setItem(LS_KEY, JSON.stringify(payload));
    } catch (e) {}
  }

  function clearSavedProgress() {
    try { localStorage.removeItem(LS_KEY); } catch (e) {}
  }

  function startAutosave() {
    if (autosaveTimer) clearInterval(autosaveTimer);
    autosaveTimer = setInterval(saveProgressToLocal, 5000);
  }

  function stopAutosave() {
    if (autosaveTimer) clearInterval(autosaveTimer);
    autosaveTimer = null;
  }

  async function fetchSessionInfo() {
    try {
      const response = await fetch('https://sanghamitra-learnworld.vercel.app/api/session-info', {
        credentials: 'include'
      });
      if (response.ok) {
        const data = await response.json();
        username = data.username;
        email = data.email;
        currentUser = { username, email };
        return true;
      } else {
        alert('Please login to take the assessment');
        window.location.href = '/login.html';
        return false;
      }
    } catch (error) {
      alert('Error connecting to server.');
      return false;
    }
  }

  async function loadQuestions() {
    try {
      const url = `https://sanghamitra-learnworld.vercel.app/api/iitm-ct-questions?topic=${encodeURIComponent(topic)}`;
      const response = await fetch(url, { credentials: 'include' });
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      const data = await response.json();
      questions = data.questions || data;
      if (!questions.length) throw new Error('No questions found.');
      questions = questions.map(q => ({
        ...q,
        difficulty: q.difficulty || 'medium',
        points: q.points || 1
      }));
      return true;
    } catch (e) {
      alert('Failed to load quiz questions.');
      return false;
    }
  }

  function initializeAntiCheating() {
    window.addEventListener('blur', () => {
      if (isQuizActive) {
        recordCheatingAttempt('window_blur');
      }
    });
    document.addEventListener('contextmenu', e => {
      e.preventDefault();
      recordCheatingAttempt('right_click');
    });
  }

  function recordCheatingAttempt(type) {
    cheatingAttempts++;
    if (username && email) {
      fetch('https://sanghamitra-learnworld.vercel.app/api/log-ct-cheating', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({
          username,
          email,
          cheatingType: type,
          timestamp: new Date(),
          currentQuestion: currentQuestionIndex + 1
        })
      });
    }
    if (cheatingAttempts >= 5) {
      alert('Multiple suspicious activities detected. Auto-submitting quiz.');
      submitQuiz();
    }
  }

  function escapeHtml(t) {
    return String(t || '')
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  function renderCurrentQuestion() {
    const c = document.getElementById('questionContainer');
    if (!c) return;
    const q = questions[currentQuestionIndex];
    if (!q) return;

    c.innerHTML = `
      <div class="question-block">
        <div class="q-header">
          <b>Q${q.question_number}.</b> ${escapeHtml(q.question_text)}
        </div>
        ${q.dataset ? `<div class="dataset">Dataset: ${escapeHtml(q.dataset)}</div>` : ''}
      </div>
    `;

    const aDiv = document.createElement('div');
    aDiv.className = 'answer-block';
    if (q.type === 'mcq') {
      aDiv.innerHTML = q.options.map((opt, i) => `
        <div class="option">
          <input type="radio" name="q${currentQuestionIndex}" id="q${currentQuestionIndex}_${i}" value="${escapeHtml(opt)}"
          onchange="ctQuiz.selectOption(${currentQuestionIndex}, this.value)">
          <label for="q${currentQuestionIndex}_${i}">${escapeHtml(opt)}</label>
        </div>
      `).join('');
    } else if (q.type === 'msq') {
      aDiv.innerHTML = q.options.map((opt, i) => `
        <div class="option">
          <input type="checkbox" name="q${currentQuestionIndex}" id="q${currentQuestionIndex}_${i}" value="${escapeHtml(opt)}"
          onchange="ctQuiz.toggleMsq(${currentQuestionIndex}, this.value, this.checked)">
          <label for="q${currentQuestionIndex}_${i}">${escapeHtml(opt)}</label>
        </div>
      `).join('');
    } else if (q.type === 'numeric') {
      aDiv.innerHTML = `
        <input type="number" placeholder="Enter number" class="numeric-input"
        oninput="ctQuiz.handleNumericInput(${currentQuestionIndex}, this.value)">
      `;
    }
    c.appendChild(aDiv);
    restoreAnswer();
    updateProgress();
  }

  function restoreAnswer() {
    const q = questions[currentQuestionIndex];
    const ans = userAnswers[currentQuestionIndex];
    if (!ans) return;
    if (q.type === 'mcq') {
      const el = document.querySelector(`input[name="q${currentQuestionIndex}"][value="${CSS.escape(ans)}"]`);
      if (el) el.checked = true;
    } else if (q.type === 'msq' && Array.isArray(ans)) {
      ans.forEach(v => {
        const el = document.querySelector(`input[name="q${currentQuestionIndex}"][value="${CSS.escape(v)}"]`);
        if (el) el.checked = true;
      });
    } else if (q.type === 'numeric') {
      const el = document.querySelector('.numeric-input');
      if (el) el.value = ans;
    }
  }

  function updateProgress() {
    const progressText = document.getElementById('progressText');
    if (progressText) progressText.textContent = `Question ${currentQuestionIndex + 1} / ${questions.length}`;
  }

  function nextQuestion() {
    trackQuestionTime();
    if (currentQuestionIndex < questions.length - 1) {
      currentQuestionIndex++;
      renderCurrentQuestion();
    } else {
      submitQuiz();
    }
  }

  function previousQuestion() {
    trackQuestionTime();
    if (currentQuestionIndex > 0) {
      currentQuestionIndex--;
      renderCurrentQuestion();
    }
  }

  function trackQuestionTime() {
    if (questionStartTime) {
      const t = Math.floor((new Date() - questionStartTime) / 1000);
      questionTimes[currentQuestionIndex] = (questionTimes[currentQuestionIndex] || 0) + t;
    }
    questionStartTime = new Date();
  }

  function selectOption(i, v) {
    userAnswers[i] = v;
    saveProgressToLocal();
  }

  function toggleMsq(i, v, checked) {
    if (!Array.isArray(userAnswers[i])) userAnswers[i] = [];
    if (checked) {
      if (!userAnswers[i].includes(v)) userAnswers[i].push(v);
    } else {
      userAnswers[i] = userAnswers[i].filter(x => x !== v);
      if (userAnswers[i].length === 0) delete userAnswers[i];
    }
    saveProgressToLocal();
  }

  function handleNumericInput(i, v) {
    if (v.trim() === '') delete userAnswers[i];
    else userAnswers[i] = v.trim();
    saveProgressToLocal();
  }

  window.ctQuiz = { selectOption, toggleMsq, handleNumericInput };

  async function submitQuiz() {
    trackQuestionTime();
    stopAutosave();

    let totalPoints = 0;
    let earnedPoints = 0;

    questions.forEach((q, i) => {
      const ans = userAnswers[i];
      totalPoints += q.points;
      let correct = false;
      if (q.type === 'mcq') {
        correct = (ans || '').toLowerCase().trim() === (q.correct_answer || '').toLowerCase().trim();
      } else if (q.type === 'numeric') {
        correct = parseFloat(ans) === parseFloat(q.correct_answer);
      } else if (q.type === 'msq') {
        const norm = a => Array.isArray(a) ? a.map(x => x.toLowerCase().trim()).sort().join(',') : '';
        correct = norm(ans) === norm(q.correct_answer);
      }
      if (correct) earnedPoints += q.points;
    });

    const score = ((earnedPoints / totalPoints) * 100).toFixed(2);

    const payload = {
      username,
      email,
      topic,
      score,
      totalPoints,
      earnedPoints,
      questionTimes,
      totalTimeTaken: Math.floor((new Date() - quizStartTime) / 1000),
      answers: userAnswers,
      timestamp: new Date()
    };

    const res = await fetch('https://sanghamitra-learnworld.vercel.app/api/iitm-ct-submission', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(payload)
    });

    if (res.ok) {
      clearSavedProgress();
      alert(`Quiz submitted successfully!\nYour Score: ${score}%`);
      window.location.href = '/ct/result.html';
    } else {
      alert('Error submitting quiz.');
    }
  }

  async function init() {
    if (!(await fetchSessionInfo())) return;
    if (!(await loadQuestions())) return;
    isQuizActive = true;
    quizStartTime = new Date();
    questionStartTime = new Date();
    initializeAntiCheating();
    loadSavedProgress();
    renderCurrentQuestion();
    startAutosave();
  }

  window.addEventListener('DOMContentLoaded', init);
})();
</script>

</body>
</html>



