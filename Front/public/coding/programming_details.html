<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programming Quiz Details</title>
    <link rel="stylesheet" href="quiz.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">
    <!-- Vendor CSS Files -->
    <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    <!-- Main CSS File -->
    <link href="../assets/css/main.css" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .card-custom {
            background: #fff;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 0 10px rgba(108, 117, 125, 0.5);
            border-radius: 8px;
        }
        
        .progress-bar-section {
            margin: 20px 0;
        }
        
        .skill-progress {
            height: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .code-correct {
            border-left: 4px solid #28a745;
        }
        
        .code-incorrect {
            border-left: 4px solid #dc3545;
        }
        
        .feedback-section {
            background-color: #f8f9fa;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
        }
        
        .recommendation-card {
            border-left: 4px solid #6610f2;
            margin-bottom: 15px;
        }
        
        .concept-badge {
            background-color: #e9ecef;
            color: #495057;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .strength-badge {
            background-color: #d4edda;
            color: #155724;
        }
        
        .weakness-badge {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .resource-link {
            display: block;
            padding: 10px;
            margin: 5px 0;
            background-color: #e9ecef;
            border-radius: 5px;
            text-decoration: none;
            color: #495057;
            transition: all 0.3s;
        }
        
        .resource-link:hover {
            background-color: #dee2e6;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-decoration: none;
        }
        
        .skill-chart-container {
            height: 300px;
            margin-bottom: 30px;
        }
        
        .summary-box {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .summary-good {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .summary-average {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .summary-poor {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .question-card {
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .question-header {
            padding: 10px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .question-body {
            padding: 15px;
        }
        
        .passed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .failed {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .next-steps-section {
            background-color: #e6f7ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">
        <a href="../index.html" class="logo d-flex align-items-center me-auto">
            <h1 class=""><img src="../img/sbi.logo.png" alt="company logo" width="80" height="80">Sanghamitra Learning</h1>
        </a>
        <nav id="navmenu" class="navmenu">
            <div id="navbar-placeholder"></div>
            <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>
    </div>
</header>

<main class="main">
    <section class="container mt-5 mb-5">
        <div class="row">
            <div class="col-lg-12 mx-auto">
                <div class="card shadow-sm mb-4 bg-light">
                    <div class="card-header text-white" style="background-color: #3498db;">
                        <h3 class="mb-1">Programming Quiz Analysis</h3>
                    </div>
                    <div class="card-body">
                        <div id="loading-container" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                            <p class="mt-2">Loading quiz details...</p>
                        </div>
                        
                        <div id="quiz-details-container" style="display: none;">
                            <!-- Summary Section -->
                            <div class="card-custom">
                                <h3>Quiz Summary</h3>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Date:</strong> <span id="quiz-date"></span></p>
                                        <p><strong>Overall Score:</strong> <span id="quiz-score"></span></p>
                                        <p><strong>Questions Passed:</strong> <span id="questions-passed"></span></p>
                                        <div id="summary-feedback" class="mt-3"></div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="canvas-container">
                                            <canvas id="performance-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Skills Assessment Section -->
                            <div class="card-custom mt-4">
                                <h3>Skills Assessment</h3>
                                <div class="skill-chart-container">
                                    <canvas id="skills-radar-chart"></canvas>
                                </div>
                                <div id="skills-analysis"></div>
                            </div>
                            
                            <!-- Question Details Section -->
                            <div class="card-custom mt-4">
                                <h3>Question Details</h3>
                                <div id="questions-container"></div>
                            </div>
                            
                            <!-- Personalized Recommendations -->
                            <div class="card-custom mt-4">
                                <h3>Personalized Recommendations</h3>
                                <div id="recommendations-container"></div>
                                
                                <div class="next-steps-section mt-4">
                                    <h4><i class="bi bi-signpost-2"></i> Next Steps</h4>
                                    <div id="next-steps-container"></div>
                                    <div class="text-center mt-3">
                                        <button class="btn btn-primary" onclick="window.location.href='programming.html'">Practice More Coding</button>
                                        <button class="btn btn-outline-secondary ml-2" onclick="window.location.href='../dashboard.html'">Back to Dashboard</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<footer id="footer" class="footer position-relative">
    <div class="container footer-top">
        <div class="row gy-4">
            <div class="col-lg-4 col-md-6 footer-about">
                <a href="../index.html" class="logo d-flex align-items-center">
                    <span class="">Sanghamitra Learning</span>
                </a>
                <div class="footer-contact pt-3">
                    <p>GacchiBowli</p>
                    <p>Hyderabad, TS 500032</p>
                    <p class="mt-3"><strong>Phone:</strong> <span>+91 7020102729</span></p>
                    <p><strong>Email:</strong> <span>sanghamitra.learnworlds@gmail.com</span></p>
                </div>
                <div class="social-links d-flex mt-4">
                    <a href=""><i class="bi bi-twitter"></i></a>
                    <a href=""><i class="bi bi-facebook"></i></a>
                    <a href=""><i class="bi bi-instagram"></i></a>
                    <a href=""><i class="bi bi-linkedin"></i></a>
                </div>
            </div>
            <div class="col-lg-4 col-md-12 footer-newsletter">
            </div>
        </div>
    </div>
    <div class="container copyright text-center mt-4">
        <p>Â© <span>Copyright</span> <strong class="px-1">Sanghamitra Learning</strong> <span>All Rights Reserved</span></p>
        <div class="credits">
            Designed by <a href="">Sanghamitra</a>
        </div>
    </div>
</footer>

<script>
    // Programming concepts mapped to question types
    const conceptMapping = {
        1: ["Variables", "Data Types", "Print Statements"],
        2: ["Conditionals", "Comparison Operators", "Return Statements"],
        3: ["Loops", "Array Manipulation", "Logic"],
        4: ["String Manipulation", "Counting", "Loops"],
        5: ["Dictionaries", "String Manipulation", "Text Analysis"],
        6: ["Error Handling", "Conditionals", "Edge Cases"],
        7: ["List Comprehension", "Functional Programming", "Array Manipulation"],
        8: ["Function Parameters", "Default Arguments", "Function Design"],
        9: ["Recursion", "Algorithm Design", "Mathematical Functions"],
        10: ["String Manipulation", "Palindromes", "Algorithm Design"]
    };
    
    // Resources for different programming concepts
    const conceptResources = {
        "Variables": [
            {title: "Python Variables Tutorial", url: "https://www.learnpython.org/en/Variables_and_Types"},
            {title: "Variables Practice Problems", url: "https://www.w3schools.com/python/python_variables_exercises.asp"}
        ],
        "Conditionals": [
            {title: "Python If...Else Tutorial", url: "https://www.w3schools.com/python/python_conditions.asp"},
            {title: "Control Flow Practice", url: "https://www.hackerrank.com/domains/python/py-introduction"}
        ],
        "Loops": [
            {title: "Python Loops", url: "https://www.learnpython.org/en/Loops"},
            {title: "Practice Loop Problems", url: "https://www.geeksforgeeks.org/python-loops/"}
        ],
        "String Manipulation": [
            {title: "Python String Methods", url: "https://www.w3schools.com/python/python_strings_methods.asp"},
            {title: "String Manipulation Practice", url: "https://www.hackerrank.com/domains/python/py-strings"}
        ],
        "List Comprehension": [
            {title: "Python List Comprehension Guide", url: "https://www.learnpython.org/en/List_Comprehensions"},
            {title: "Advanced List Comprehension", url: "https://www.pythonforbeginners.com/basics/list-comprehensions-in-python"}
        ],
        "Dictionaries": [
            {title: "Python Dictionaries", url: "https://www.w3schools.com/python/python_dictionaries.asp"},
            {title: "Dictionary Practice Problems", url: "https://www.hackerrank.com/domains/python/py-collections"}
        ],
        "Recursion": [
            {title: "Understanding Recursion in Python", url: "https://realpython.com/python-thinking-recursively/"},
            {title: "Recursion Practice Problems", url: "https://www.geeksforgeeks.org/recursion-practice-problems-solutions/"}
        ],
        "Error Handling": [
            {title: "Python Exceptions and Error Handling", url: "https://realpython.com/python-exceptions/"},
            {title: "Exception Handling Practice", url: "https://www.hackerrank.com/domains/python/errors-exceptions"}
        ],
        "Function Parameters": [
            {title: "Python Functions Tutorial", url: "https://www.w3schools.com/python/python_functions.asp"},
            {title: "Advanced Function Parameters", url: "https://realpython.com/python-kwargs-and-args/"}
        ],
        "Algorithm Design": [
            {title: "Introduction to Algorithms in Python", url: "https://realpython.com/python-algorithms/"},
            {title: "Algorithm Design Practice", url: "https://leetcode.com/problemset/all/?difficulty=EASY"}
        ]
    };
    
    // Get quiz ID from URL query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const quizId = urlParams.get('quizId');
    
    // Main function to initialize the page
    async function init() {
        if (!quizId) {
            try {
                // Fetch session info to get email
                const sessionResponse = await fetch('https://sanghamitra-learnworld.vercel.app/api/session-info', {
                    credentials: 'include'
                });
                
                if (!sessionResponse.ok) {
                    throw new Error('Failed to fetch session info');
                }
                
                const sessionData = await sessionResponse.json();
                const email = sessionData.email;
                
                // Now fetch programming data
                const progResponse = await fetch(`https://sanghamitra-learnworld.vercel.app/api/programming?email=${email}`);
                
                if (!progResponse.ok) {
                    throw new Error('Failed to fetch programming data');
                }
                
                const progData = await progResponse.json();
                
                // Check if there are any quizzes
                if (!progData.quizzes || progData.quizzes.length === 0) {
                    document.getElementById('loading-container').innerHTML = 
                        `<div class="alert alert-danger">Error: No quizzes found. Please take a quiz first.</div>
                        <button class="btn btn-primary" onclick="window.location.href='../dashboard.html'">Back to Dashboard</button>`;
                    return;
                }
                
                // Use the last quiz entry
                const latestQuiz = progData.quizzes[progData.quizzes.length - 1];
                
                // Process the latest quiz
                processQuizData(latestQuiz);
                
                // Hide loading, show content
                document.getElementById('loading-container').style.display = 'none';
                document.getElementById('quiz-details-container').style.display = 'block';
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading-container').innerHTML = 
                    `<div class="alert alert-danger">Error: ${error.message}</div>
                    <button class="btn btn-primary" onclick="window.location.href='../dashboard.html'">Back to Dashboard</button>`;
            }
            return;
        }
        
        try {
            // Fetch session info to get email
            const sessionResponse = await fetch('https://sanghamitra-learnworld.vercel.app/api/session-info', {
                credentials: 'include'
            });
            
            if (!sessionResponse.ok) {
                throw new Error('Failed to fetch session info');
            }
            
            const sessionData = await sessionResponse.json();
            const email = sessionData.email;
            
            // Now fetch programming data
            const progResponse = await fetch(`https://sanghamitra-learnworld.vercel.app/api/programming?email=${email}`);
            
            if (!progResponse.ok) {
                throw new Error('Failed to fetch programming data');
            }
            
            const progData = await progResponse.json();
            
            // Find the specific quiz by ID
            const quiz = progData.quizzes.find(q => q._id === quizId);
            
            if (!quiz) {
                throw new Error('Quiz not found');
            }
            
            // Process and display quiz data
            processQuizData(quiz);
            
            // Hide loading, show content
            document.getElementById('loading-container').style.display = 'none';
            document.getElementById('quiz-details-container').style.display = 'block';
            
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('loading-container').innerHTML = 
                `<div class="alert alert-danger">Error: ${error.message}</div>
                <button class="btn btn-primary" onclick="window.location.href='../dashboard.html'">Back to Dashboard</button>`;
        }
    }
    
    // Process and display the quiz data
    function processQuizData(quiz) {
        // Format date
        const quizDate = new Date(quiz.datetime).toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        // Calculate stats
        const totalQuestions = quiz.submissions.length;
        const passedQuestions = quiz.submissions.filter(sub => sub.test_cases_passed > 0).length;
        const score = quiz.score;
        const scorePercentage = (score / totalQuestions) * 100;
        
        // Display basic info
        document.getElementById('quiz-date').textContent = quizDate;
        document.getElementById('quiz-score').textContent = `${score}/${totalQuestions} (${scorePercentage.toFixed(1)}%)`;
        document.getElementById('questions-passed').textContent = `${passedQuestions}/${totalQuestions}`;
        
        // Create performance chart
        createPerformanceChart(passedQuestions, totalQuestions - passedQuestions);
        
        // Generate skill analysis
        generateSkillsAnalysis(quiz.submissions);
        
        // Display question details
        displayQuestionDetails(quiz.submissions);
        
        // Generate personalized recommendations
        generateRecommendations(quiz.submissions);
        
        // Provide summary feedback
        provideSummaryFeedback(scorePercentage);
        
        // Generate next steps
        generateNextSteps(quiz.submissions);
    }
    
    // Create the performance chart
    function createPerformanceChart(passed, failed) {
        const ctx = document.getElementById('performance-chart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Passed', 'Failed'],
                datasets: [{
                    data: [passed, failed],
                    backgroundColor: ['#28a745', '#dc3545'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }
    
    // Generate skills analysis based on the submissions
    function generateSkillsAnalysis(submissions) {
        // Define skill categories
        const skillCategories = [
            "Variables & Data Types",
            "Conditionals",
            "Loops & Iteration",
            "String Manipulation",
            "Data Structures",
            "Error Handling",
            "Functional Programming",
            "Algorithm Design"
        ];
        
        // Initialize skill scores
        const skillScores = {
            "Variables & Data Types": 0,
            "Conditionals": 0,
            "Loops & Iteration": 0,
            "String Manipulation": 0,
            "Data Structures": 0,
            "Error Handling": 0,
            "Functional Programming": 0,
            "Algorithm Design": 0
        };
        
        // Count skill occurrences
        const skillOccurrences = { ...skillScores };
        
        // Mapping questions to skill categories
        const questionToSkillMap = {
            1: ["Variables & Data Types"],
            2: ["Conditionals"],
            3: ["Loops & Iteration", "Data Structures"],
            4: ["String Manipulation", "Loops & Iteration"],
            5: ["Data Structures", "String Manipulation"],
            6: ["Error Handling", "Conditionals"],
            7: ["Functional Programming", "Data Structures"],
            8: ["Functional Programming"],
            9: ["Algorithm Design", "Functional Programming"],
            10: ["Algorithm Design", "String Manipulation"]
        };
        
        // Calculate skill scores based on question performance
        submissions.forEach(submission => {
            const questionId = submission.question_id;
            const skills = questionToSkillMap[questionId] || [];
            
            skills.forEach(skill => {
                skillOccurrences[skill]++;
                if (submission.test_cases_passed > 0) {
                    skillScores[skill]++;
                }
            });
        });
        
        // Calculate skill percentages
        const skillPercentages = {};
        Object.keys(skillScores).forEach(skill => {
            if (skillOccurrences[skill] > 0) {
                skillPercentages[skill] = (skillScores[skill] / skillOccurrences[skill]) * 100;
            } else {
                skillPercentages[skill] = 0;
            }
        });
        
        // Create radar chart
        createSkillsRadarChart(skillCategories, skillPercentages);
        
        // Generate skill analysis text
        const skillsAnalysisContainer = document.getElementById('skills-analysis');
        
        // Determine strengths and weaknesses
        const strengths = Object.keys(skillPercentages)
            .filter(skill => skillPercentages[skill] >= 70 && skillOccurrences[skill] > 0)
            .sort((a, b) => skillPercentages[b] - skillPercentages[a]);
            
        const weaknesses = Object.keys(skillPercentages)
            .filter(skill => skillPercentages[skill] < 70 && skillOccurrences[skill] > 0)
            .sort((a, b) => skillPercentages[a] - skillPercentages[b]);
        
        // Generate HTML
        let analysisHTML = '<div class="row mt-4">';
        
        // Strengths section
        analysisHTML += `
            <div class="col-md-6">
                <div class="card-custom">
                    <h4><i class="bi bi-star-fill text-warning"></i> Your Strengths</h4>
                    <div class="mt-3">`;
        
        if (strengths.length > 0) {
            strengths.forEach(skill => {
                analysisHTML += `
                    <span class="concept-badge strength-badge">
                        ${skill} (${Math.round(skillPercentages[skill])}%)
                    </span>`;
            });
        } else {
            analysisHTML += `<p>Keep practicing to develop your programming strengths!</p>`;
        }
        
        analysisHTML += `</div></div></div>`;
        
        // Weaknesses section
        analysisHTML += `
            <div class="col-md-6">
                <div class="card-custom">
                    <h4><i class="bi bi-tools text-secondary"></i> Areas for Improvement</h4>
                    <div class="mt-3">`;
        
        if (weaknesses.length > 0) {
            weaknesses.forEach(skill => {
                analysisHTML += `
                    <span class="concept-badge weakness-badge">
                        ${skill} (${Math.round(skillPercentages[skill])}%)
                    </span>`;
            });
        } else {
            analysisHTML += `<p>Great job! You're showing proficiency across all tested skills.</p>`;
        }
        
        analysisHTML += `</div></div></div></div>`;
        
        skillsAnalysisContainer.innerHTML = analysisHTML;
    }
    
    // Create the skills radar chart
    function createSkillsRadarChart(categories, percentages) {
        const ctx = document.getElementById('skills-radar-chart').getContext('2d');
        
        const data = categories.map(category => percentages[category] || 0);
        
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: categories,
                datasets: [{
                    label: 'Skill Proficiency (%)',
                    data: data,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(54, 162, 235, 1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0,
                        suggestedMax: 100
                    }
                }
            }
        });
    }
    
    // Display question details
    function displayQuestionDetails(submissions) {
        const container = document.getElementById('questions-container');
        let html = '';
        
        submissions.forEach(submission => {
            const questionId = submission.question_id;
            const userCode = submission.user_code || 'No code submitted';
            const passed = submission.test_cases_passed > 0;
            const statusClass = passed ? 'passed' : 'failed';
            const statusText = passed ? 'Passed' : 'Failed';
            const statusIcon = passed ? 'bi-check-circle-fill' : 'bi-x-circle-fill';
            
            // Get concepts for this question
            const concepts = conceptMapping[questionId] || ['Programming Concepts'];
            const conceptsHTML = concepts.map(concept => 
                `<span class="concept-badge">${concept}</span>`
            ).join(' ');
            
            html += `
                <div class="card question-card mb-4">
                    <div class="question-header ${statusClass}">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="bi ${statusIcon}"></i> Question ${questionId} - ${statusText}</h5>
                            <div class="concepts">
                                ${conceptsHTML}
                            </div>
                        </div>
                    </div>
                    <div class="question-body">
                        <h6>Your Code:</h6>
                        <div class="code-block code-${passed ? 'correct' : 'incorrect'}">
                            ${userCode}
                        </div>
                        <div class="feedback-section mt-3">
                            <h6><i class="bi bi-chat-left-text"></i> Feedback:</h6>
                            ${generateCodeFeedback(questionId, userCode, passed)}
                        </div>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // Generate code feedback based on question and code
    function generateCodeFeedback(questionId, code, passed) {
        if (passed) {
            return `
                <p class="text-success">
                    <i class="bi bi-emoji-smile"></i> Great job! Your code passed the test cases for this question.
                </p>
                ${getPositiveFeedback(questionId, code)}
            `;
        } else {
            return `
                <p class="text-danger">
                    <i class="bi bi-emoji-frown"></i> Your code didn't pass the test cases for this question.
                </p>
                ${getNegativeFeedback(questionId, code)}
            `;
        }
    }
    
    // Get positive feedback for passing code
    function getPositiveFeedback(questionId, code) {
        const feedbacks = {
            1: "You've correctly created and printed variables of different types. Good use of the print function!",
            2: "Your conditional logic for checking whether a number is positive, negative, or zero is correct. Well done!",
            3: "You've successfully implemented the logic to sum even numbers from the array. Good job!",
            4: "Great job implementing a function to count vowels in a string. Your string handling is good!",
            5: "Well done on creating a word frequency counter! Your dictionary usage is excellent.",
            6: "Excellent work on implementing error handling in your division function. You've handled the edge cases well!",
            7: "Great use of list comprehension to generate squares! You've used modern Python features effectively.",
            8: "You've correctly implemented a function with default parameters. Your function design is good!",
            9: "Excellent recursive solution for calculating factorial! You've understood the base case and recursive step.",
            10: "Great job implementing the palindrome checker! Your string manipulation skills are solid."
        };
        
        return `<p>${feedbacks[questionId] || "Good work on this question!"}</p>`;
    }
    
    // Get negative feedback for failing code
    function getNegativeFeedback(questionId, code) {
        // Check if code is empty or just placeholder
        if (!code || code.includes('pass') || code.includes('# Your code here')) {
            return `<p>It looks like you haven't fully implemented this solution yet. Try to write code that addresses the problem statement.</p>`;
        }
        
        const commonIssues = {
            1: [
                "Make sure you're creating variables with the correct types (integer, float, string).",
                "Check that you're printing each variable on a separate line.",
                "Verify that your variable names match what's expected in the problem statement."
            ],
            2: [
                "Your function should return 'Positive', 'Negative', or 'Zero' based on the input number.",
                "Check your conditional statements to ensure they cover all cases.",
                "Make sure you're handling the case when num is exactly 0."
            ],
            3: [
                "Make sure your function filters for even numbers before summing.",
                "Check that you're correctly iterating through the list of numbers.",
                "Verify that you're returning the sum rather than just calculating it."
            ],
            4: [
                "Ensure your function counts all vowels (a, e, i, o, u) in the text.",
                "Consider converting the text to lowercase to handle both upper and lower case vowels.",
                "Check your loop or string iteration approach."
            ],
            5: [
                "Make sure you're correctly splitting the text into words.",
                "Verify that you're using a dictionary to count word frequencies.",
                "Check that you're returning the complete dictionary with all word counts."
            ],
            6: [
                "Make sure your function handles division by zero with a try/except block.",
                "Verify that you're returning appropriate error messages or values when exceptions occur.",
                "Check that your function correctly performs division when inputs are valid."
            ],
            7: [
                "Your function should use list comprehension to generate squares of numbers.",
                "Check that you're filtering for even numbers if required by the problem.",
                "Verify the range of numbers you're processing."
            ],
            8: [
                "Make sure your function parameters are defined in the correct order.",
                "Check that default parameters are set to the expected values.",
                "Verify that your function performs the correct calculation with the inputs."
            ],
            9: [
                "Your recursive function should have a base case for factorial(0) or factorial(1).",
                "Check that your recursive call is correctly reducing toward the base case.",
                "Verify that you're not causing an infinite recursion."
            ],
            10: [
                "Make sure you're correctly checking if a string reads the same backward as forward.",
                "Consider handling spaces and punctuation if required by the problem.",
                "Verify that you're comparing characters in a case-insensitive manner if needed."
            ]
        };
        
        const issues = commonIssues[questionId] || ["Check your logic and implementation against the problem requirements."];
        
        let feedbackHTML = `<ul class="text-muted">`;
        issues.forEach(issue => {
            feedbackHTML += `<li>${issue}</li>`;
        });
        feedbackHTML += `</ul>`;
        
        return feedbackHTML;
    }
    
    // Generate personalized recommendations
    function generateRecommendations(submissions) {
        const container = document.getElementById('recommendations-container');
        
        // Identify weak concepts based on failed questions
        const failedSubmissions = submissions.filter(sub => sub.test_cases_passed === 0);
        
        // Collect concepts from failed questions
        const weakConcepts = new Set();
        failedSubmissions.forEach(sub => {
            const concepts = conceptMapping[sub.question_id] || [];
            concepts.forEach(concept => weakConcepts.add(concept));
        });
        
        let html = '';
        
        // If no failed submissions, show encouraging message
        if (failedSubmissions.length === 0) {
            html += `
                <div class="alert alert-success">
                    <i class="bi bi-trophy"></i> 
                    <strong>Congratulations!</strong> You've done very well on this quiz. Keep practicing to maintain your skills!
                </div>
            `;
        } else {
            // Add recommendation cards for each weak concept
            Array.from(weakConcepts).forEach(concept => {
                const resources = conceptResources[concept] || [];
                
                html += `
                    <div class="card-custom recommendation-card">
                        <h5><i class="bi bi-book"></i> Practice ${concept}</h5>
                        <p>You might benefit from additional practice with ${concept.toLowerCase()}.</p>
                        
                        <h6 class="mt-3">Recommended Resources:</h6>
                        <div class="resource-links">`;
                
                if (resources.length > 0) {
                    resources.forEach(resource => {
                        html += `
                            <a href="${resource.url}" target="_blank" class="resource-link">
                                <i class="bi bi-link-45deg"></i> ${resource.title}
                            </a>
                        `;
                    });
                } else {
                    html += `<p>Search for "${concept} programming tutorial" online for helpful resources.</p>`;
                }
                
                html += `</div></div>`;
            });
        }
        
        container.innerHTML = html;
    }
    
    // Provide summary feedback
    function provideSummaryFeedback(scorePercentage) {
        const container = document.getElementById('summary-feedback');
        let className, icon, message;
        
        if (scorePercentage >= 80) {
            className = 'summary-good';
            icon = 'bi-emoji-smile';
            message = 'Excellent work! You have a strong understanding of programming concepts.';
        } else if (scorePercentage >= 60) {
            className = 'summary-average';
            icon = 'bi-emoji-neutral';
            message = 'Good job! You understand many programming concepts but have some areas for improvement.';
        } else {
            className = 'summary-poor';
            icon = 'bi-emoji-frown';
            message = 'Keep practicing! You\'re making progress, but need to strengthen your programming foundation.';
        }
        
        container.innerHTML = `
            <div class="summary-box ${className}">
                <h5><i class="bi ${icon}"></i> Overall Assessment</h5>
                <p>${message}</p>
            </div>
        `;
    }
    
    // Generate next steps
    function generateNextSteps(submissions) {
        const container = document.getElementById('next-steps-container');
        
        // Calculate skill level based on performance
        const passRate = submissions.filter(sub => sub.test_cases_passed > 0).length / submissions.length;
        
        let nextSteps;
        
        if (passRate >= 0.8) {
            nextSteps = [
                "Challenge yourself with advanced problems on platforms like LeetCode or HackerRank",
                "Try building a small project to apply your knowledge in a real-world context",
                "Explore advanced topics like data structures, algorithms, or specific frameworks"
            ];
        } else if (passRate >= 0.5) {
            nextSteps = [
                "Focus on the specific concepts highlighted in your areas for improvement",
                "Practice more questions with similar difficulty to build consistency",
                "Review the code solutions for questions you found challenging"
            ];
        } else {
            nextSteps = [
                "Strengthen your foundation by reviewing basic programming concepts",
                "Practice simple problems to build confidence and understanding",
                "Consider working through a structured programming tutorial series"
            ];
        }
        
        let html = '<ul class="list-group list-group-flush">';
        nextSteps.forEach(step => {
            html += `<li class="list-group-item bg-transparent"><i class="bi bi-check2-circle"></i> ${step}</li>`;
        });
        html += '</ul>';
        
        container.innerHTML = html;
    }
    
    // Initialize the page when loaded
    window.addEventListener('DOMContentLoaded', init);
</script>

<!-- Bootstrap and other JS libraries -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Vendor JS Files -->
<script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../assets/vendor/aos/aos.js"></script>
<script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>
<script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

<!-- Template Main JS File -->
<script src="../assets/js/main.js"></script>
<script src="../assets/js/navbar.js"></script>
</body>
</html>
